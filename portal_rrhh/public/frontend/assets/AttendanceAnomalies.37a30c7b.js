var j=(M,x,r)=>new Promise((n,c)=>{var g=m=>{try{f(r.next(m))}catch(h){c(h)}},u=m=>{try{f(r.throw(m))}catch(h){c(h)}},f=m=>m.done?n(m.value):Promise.resolve(m.value).then(g,u);f((r=r.apply(M,x)).next())});import{r as w,q as D,X as L,o as i,c as d,b as t,t as a,d as y,u as p,a5 as B,w as E,Q as V,n as k,f as b,C as F,s as O,F as P,E as T,_ as G,a1 as U,e as C}from"./vendor.b007e8f2.js";import{d as A}from"./es.57c2289d.js";const H={class:"flex flex-col h-full overflow-hidden bg-white"},W={class:"flex-1 overflow-y-auto p-5"},q={class:"mb-6 flex items-center justify-between"},Q={class:"text-2xl font-bold text-gray-900"},X={class:"bg-gray-50 rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},K={class:"grid grid-cols-12 gap-4 items-end"},R={class:"col-span-6 md:col-span-5"},Z={class:"block text-sm font-medium text-gray-700 mb-1"},ee={class:"col-span-6 md:col-span-5"},te={class:"block text-sm font-medium text-gray-700 mb-1"},se={class:"col-span-12 md:col-span-2"},ae={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},oe={class:"text-xs text-gray-500 font-medium uppercase"},le={class:"text-3xl font-bold text-gray-900 mt-2"},ne={key:0,class:"text-xs text-gray-400 mt-1"},re={class:"text-xs text-gray-500 font-medium uppercase"},ie={class:"text-3xl font-bold text-gray-900 mt-2"},de={key:0,class:"text-xs text-gray-400 mt-1"},ce={class:"text-xs text-gray-500 font-medium uppercase"},ue={class:"text-3xl font-bold text-gray-900 mt-2"},me={key:0,class:"text-xs text-gray-400 mt-1"},ge={class:"text-xs text-gray-500 font-medium uppercase"},he={class:"text-3xl font-bold text-gray-900 mt-2"},pe={key:0,class:"text-xs text-gray-400 mt-1"},fe={key:0,class:"mb-4 flex items-center gap-2"},ve={class:"text-lg font-semibold text-gray-800"},_e={key:1,class:"bg-white rounded-lg border border-gray-200 shadow-sm"},ye={class:"overflow-hidden"},be=["onClick"],xe={class:"flex items-center gap-3"},we={class:"h-8 w-8 rounded-full bg-gray-100 flex items-center justify-center text-xs font-bold text-gray-600"},ke={class:"text-sm font-semibold text-gray-900"},Ee={class:"text-xs text-gray-500"},Ce={key:0,class:"bg-gray-50/50 p-4 border-t border-gray-100 pl-14"},Ae={class:"w-full"},Me={class:"text-left text-xs text-gray-500 uppercase"},je={class:"pb-2 font-medium"},De={class:"pb-2 font-medium"},Be={class:"pb-2 font-medium"},Ve={class:"divide-y divide-gray-100"},Fe={class:"py-2 text-sm text-gray-900 font-medium w-32 whitespace-nowrap"},Pe={class:"py-2 w-48"},Te={class:"py-2 text-sm text-gray-600"},Ge={key:2,class:"text-center py-12 bg-white rounded-lg border border-dashed border-gray-300"},Ne={class:"text-gray-400 mb-2"},Ye={class:"text-gray-500 font-medium"},Se={key:3,class:"text-center py-20"},$e={class:"text-lg font-medium text-gray-900 mb-2"},Ie={class:"text-gray-500 max-w-sm mx-auto"},Oe={__name:"AttendanceAnomalies",setup(M){A.locale("es");const x=w(!1),r=w([]),n=w(null),c=w([]),g=w({from_date:A().subtract(30,"days").format("YYYY-MM-DD"),to_date:A().format("YYYY-MM-DD")}),u=D(()=>({total:r.value.length,ghost:r.value.filter(e=>e.type==="Ghost Employee").length,missing:r.value.filter(e=>e.type==="Missing Punch").length,time:r.value.filter(e=>["Excessive Continuous Work","No Break"].includes(e.type)).length,absent:r.value.filter(e=>e.type==="Absent").length})),f=D(()=>{if(!n.value)return[];let e=[];n.value==="Ghost Employee"?e=r.value.filter(s=>s.type==="Ghost Employee"):n.value==="Missing Punch"?e=r.value.filter(s=>s.type==="Missing Punch"):n.value==="Time Issue"?e=r.value.filter(s=>["Excessive Continuous Work","No Break"].includes(s.type)):n.value==="Absent"&&(e=r.value.filter(s=>s.type==="Absent"));const l={};return e.forEach(s=>{l[s.employee]||(l[s.employee]=[]),l[s.employee].push(s)}),Object.keys(l).map(s=>({employee:s,items:l[s].sort((v,_)=>new Date(_.date)-new Date(v.date))})).sort((s,v)=>v.items.length!==s.items.length?v.items.length-s.items.length:s.employee.localeCompare(v.employee))}),m=()=>j(this,null,function*(){x.value=!0;try{const e=yield U("portal_rrhh.api.attendance.get_attendance_anomalies",{employee:null,from_date:g.value.from_date,to_date:g.value.to_date});e&&e.success?r.value=e.data:r.value=[]}catch(e){console.error(e)}finally{x.value=!1,c.value=[]}}),h=e=>{n.value===e?n.value=null:n.value=e,c.value=[]},N=e=>{c.value.includes(e)?c.value=c.value.filter(l=>l!==e):c.value.push(e)},Y=e=>e?e.split(" ").map(l=>l[0]).join("").substring(0,2).toUpperCase():"?",S=e=>e==="Ghost Employee"?o("Sin Fichajes (Job Offer)"):e==="Missing Punch"?o("Fichajes Faltantes"):e==="Time Issue"?o("Jornada > 6h sin descanso"):e==="Absent"?o("Ausencias"):e,$=e=>e==="Ghost Employee"?"purple":e==="Missing Punch"?"orange":e==="Time Issue"?"blue":e==="Absent"?"red":"gray",I=e=>A(e).format("DD MMM (ddd)"),o=e=>e,z=e=>e==="Missing Punch"?"orange":e==="Absent"||e==="Ghost Employee"?"red":["Late Entry","Early Exit","No Break"].includes(e)||e.includes("Excessive")?"yellow":"gray";return L(()=>{m()}),(e,l)=>(i(),d("div",H,[t("div",W,[t("div",q,[t("h1",Q,a(o("Anomal\xEDas de Asistencia")),1)]),t("div",X,[t("div",K,[t("div",R,[t("label",Z,a(o("Desde")),1),y(p(B),{modelValue:g.value.from_date,"onUpdate:modelValue":l[0]||(l[0]=s=>g.value.from_date=s),class:"w-full"},null,8,["modelValue"])]),t("div",ee,[t("label",te,a(o("Hasta")),1),y(p(B),{modelValue:g.value.to_date,"onUpdate:modelValue":l[1]||(l[1]=s=>g.value.to_date=s),class:"w-full"},null,8,["modelValue"])]),t("div",se,[y(p(V),{variant:"solid",theme:"gray",class:"w-full justify-center !bg-black !text-white hover:!bg-gray-800",loading:x.value,onClick:m},{default:E(()=>[C(a(o("Actualizar")),1)]),_:1},8,["loading"])])])]),t("div",ae,[t("div",{class:k(["cursor-pointer p-4 rounded-lg border shadow-sm transition-all duration-200 flex flex-col",n.value==="Ghost Employee"?"bg-purple-50 border-purple-200 ring-2 ring-purple-100":"bg-white border-gray-200 hover:border-purple-200"]),onClick:l[2]||(l[2]=s=>h("Ghost Employee"))},[t("span",oe,a(o("Sin Fichajes (Job Offer)")),1),t("span",le,a(u.value.ghost),1),u.value.ghost>0?(i(),d("span",ne,a(o("Empleados sin actividad")),1)):b("",!0)],2),t("div",{class:k(["cursor-pointer p-4 rounded-lg border shadow-sm transition-all duration-200 flex flex-col",n.value==="Missing Punch"?"bg-orange-50 border-orange-200 ring-2 ring-orange-100":"bg-white border-gray-200 hover:border-orange-200"]),onClick:l[3]||(l[3]=s=>h("Missing Punch"))},[t("span",re,a(o("Fichajes Faltantes")),1),t("span",ie,a(u.value.missing),1),u.value.missing>0?(i(),d("span",de,a(o("Entradas sin Salida (o viceversa)")),1)):b("",!0)],2),t("div",{class:k(["cursor-pointer p-4 rounded-lg border shadow-sm transition-all duration-200 flex flex-col",n.value==="Time Issue"?"bg-blue-50 border-blue-200 ring-2 ring-blue-100":"bg-white border-gray-200 hover:border-blue-200"]),onClick:l[4]||(l[4]=s=>h("Time Issue"))},[t("span",ce,a(o("Jornada > 6h sin descanso")),1),t("span",ue,a(u.value.time),1),u.value.time>0?(i(),d("span",me,a(o("Sesiones largas o sin pausa")),1)):b("",!0)],2),t("div",{class:k(["cursor-pointer p-4 rounded-lg border shadow-sm transition-all duration-200 flex flex-col",n.value==="Absent"?"bg-red-50 border-red-200 ring-2 ring-red-100":"bg-white border-gray-200 hover:border-red-200"]),onClick:l[5]||(l[5]=s=>h("Absent"))},[t("span",ge,a(o("Ausencias")),1),t("span",he,a(u.value.absent),1),u.value.absent>0?(i(),d("span",pe,a(o("Sin justificar")),1)):b("",!0)],2)]),n.value?(i(),d("div",fe,[t("h2",ve,a(S(n.value)),1),y(p(F),{theme:$(n.value),size:"lg"},{default:E(()=>[C(a(f.value.length)+" "+a(o("Empleados")),1)]),_:1},8,["theme"]),n.value?(i(),O(p(V),{key:0,variant:"ghost",class:"ml-auto",onClick:l[6]||(l[6]=s=>n.value=null)},{default:E(()=>[C(a(o("Cerrar")),1)]),_:1})):b("",!0)])):b("",!0),n.value&&f.value.length>0?(i(),d("div",_e,[t("div",ye,[(i(!0),d(P,null,T(f.value,(s,v)=>(i(),d("div",{key:v,class:"border-b last:border-b-0 border-gray-100"},[t("div",{class:"p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50 transition-colors",onClick:_=>N(s.employee)},[t("div",xe,[t("div",we,a(Y(s.employee)),1),t("div",null,[t("div",ke,a(s.employee),1),t("div",Ee,a(s.items.length)+" "+a(s.items.length===1?o("anomal\xEDa"):o("anomal\xEDas")),1)])]),t("div",{class:k(["transform transition-transform duration-200",{"rotate-180":c.value.includes(s.employee)}])},[y(p(G),{name:"chevron-down",class:"w-4 h-4 text-gray-400"})],2)],8,be),c.value.includes(s.employee)?(i(),d("div",Ce,[t("table",Ae,[t("thead",null,[t("tr",Me,[t("th",je,a(o("Fecha")),1),t("th",De,a(o("Tipo")),1),t("th",Be,a(o("Detalle")),1)])]),t("tbody",Ve,[(i(!0),d(P,null,T(s.items,(_,J)=>(i(),d("tr",{key:J},[t("td",Fe,a(I(_.date)),1),t("td",Pe,[y(p(F),{theme:z(_.type),size:"sm"},{default:E(()=>[C(a(o(_.type)),1)]),_:2},1032,["theme"])]),t("td",Te,a(_.description),1)]))),128))])])])):b("",!0)]))),128))])])):n.value?(i(),d("div",Ge,[t("div",Ne,[y(p(G),{name:"check-circle",class:"w-8 h-8 mx-auto"})]),t("p",Ye,a(o("No hay anomal\xEDas de este tipo en el per\xEDodo seleccionado.")),1)])):(i(),d("div",Se,[t("h3",$e,a(o("Selecciona una categor\xEDa")),1),t("p",Ie,a(o("Haz clic en una de las tarjetas de arriba para ver los empleados afectados y los detalles.")),1)]))])]))}};export{Oe as default};
