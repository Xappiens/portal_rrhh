var J=(L,T,g)=>new Promise((n,y)=>{var x=v=>{try{h(g.next(v))}catch(b){y(b)}},$=v=>{try{h(g.throw(v))}catch(b){y(b)}},h=v=>v.done?n(v.value):Promise.resolve(v.value).then(x,$);h((g=g.apply(L,T)).next())});import{a4 as Z,r as I,l as V,a5 as tt,K as q,q as W,X as et,a6 as st,u as f,o as w,c as k,b as r,t as c,d as C,w as E,_ as ot,e as A,Q as G,f as P,J as nt,a7 as K}from"./vendor.6b0ecc0f.js";import{d as m}from"./es.3448d6cc.js";import{_ as at}from"./AttendanceCalendar.df74820a.js";var Q={exports:{}};(function(L,T){(function(g,n){L.exports=n()})(Z,function(){var g,n,y=1e3,x=6e4,$=36e5,h=864e5,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,b=31536e6,O=2628e6,z=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,M={years:b,months:O,days:h,hours:$,minutes:x,seconds:y,milliseconds:1,weeks:6048e5},Y=function(l){return l instanceof F},S=function(l,s,t){return new F(l,t,s.$l)},u=function(l){return n.p(l)+"s"},D=function(l){return l<0},H=function(l){return D(l)?Math.ceil(l):Math.floor(l)},N=function(l){return Math.abs(l)},j=function(l,s){return l?D(l)?{negative:!0,format:""+N(l)+s}:{negative:!1,format:""+l+s}:{negative:!1,format:""}},F=function(){function l(t,e,o){var a=this;if(this.$d={},this.$l=o,t===void 0&&(this.$ms=0,this.parseFromMilliseconds()),e)return S(t*M[u(e)],this);if(typeof t=="number")return this.$ms=t,this.parseFromMilliseconds(),this;if(typeof t=="object")return Object.keys(t).forEach(function(_){a.$d[u(_)]=t[_]}),this.calMilliseconds(),this;if(typeof t=="string"){var i=t.match(z);if(i){var d=i.slice(2).map(function(_){return _!=null?Number(_):0});return this.$d.years=d[0],this.$d.months=d[1],this.$d.weeks=d[2],this.$d.days=d[3],this.$d.hours=d[4],this.$d.minutes=d[5],this.$d.seconds=d[6],this.calMilliseconds(),this}}return this}var s=l.prototype;return s.calMilliseconds=function(){var t=this;this.$ms=Object.keys(this.$d).reduce(function(e,o){return e+(t.$d[o]||0)*M[o]},0)},s.parseFromMilliseconds=function(){var t=this.$ms;this.$d.years=H(t/b),t%=b,this.$d.months=H(t/O),t%=O,this.$d.days=H(t/h),t%=h,this.$d.hours=H(t/$),t%=$,this.$d.minutes=H(t/x),t%=x,this.$d.seconds=H(t/y),t%=y,this.$d.milliseconds=t},s.toISOString=function(){var t=j(this.$d.years,"Y"),e=j(this.$d.months,"M"),o=+this.$d.days||0;this.$d.weeks&&(o+=7*this.$d.weeks);var a=j(o,"D"),i=j(this.$d.hours,"H"),d=j(this.$d.minutes,"M"),_=this.$d.seconds||0;this.$d.milliseconds&&(_+=this.$d.milliseconds/1e3,_=Math.round(1e3*_)/1e3);var p=j(_,"S"),B=t.negative||e.negative||a.negative||i.negative||d.negative||p.negative,X=i.format||d.format||p.format?"T":"",U=(B?"-":"")+"P"+t.format+e.format+a.format+X+i.format+d.format+p.format;return U==="P"||U==="-P"?"P0D":U},s.toJSON=function(){return this.toISOString()},s.format=function(t){var e=t||"YYYY-MM-DDTHH:mm:ss",o={Y:this.$d.years,YY:n.s(this.$d.years,2,"0"),YYYY:n.s(this.$d.years,4,"0"),M:this.$d.months,MM:n.s(this.$d.months,2,"0"),D:this.$d.days,DD:n.s(this.$d.days,2,"0"),H:this.$d.hours,HH:n.s(this.$d.hours,2,"0"),m:this.$d.minutes,mm:n.s(this.$d.minutes,2,"0"),s:this.$d.seconds,ss:n.s(this.$d.seconds,2,"0"),SSS:n.s(this.$d.milliseconds,3,"0")};return e.replace(v,function(a,i){return i||String(o[a])})},s.as=function(t){return this.$ms/M[u(t)]},s.get=function(t){var e=this.$ms,o=u(t);return o==="milliseconds"?e%=1e3:e=o==="weeks"?H(e/M[o]):this.$d[o],e||0},s.add=function(t,e,o){var a;return a=e?t*M[u(e)]:Y(t)?t.$ms:S(t,this).$ms,S(this.$ms+a*(o?-1:1),this)},s.subtract=function(t,e){return this.add(t,e,!0)},s.locale=function(t){var e=this.clone();return e.$l=t,e},s.clone=function(){return S(this.$ms,this)},s.humanize=function(t){return g().add(this.$ms,"ms").locale(this.$l).fromNow(!t)},s.valueOf=function(){return this.asMilliseconds()},s.milliseconds=function(){return this.get("milliseconds")},s.asMilliseconds=function(){return this.as("milliseconds")},s.seconds=function(){return this.get("seconds")},s.asSeconds=function(){return this.as("seconds")},s.minutes=function(){return this.get("minutes")},s.asMinutes=function(){return this.as("minutes")},s.hours=function(){return this.get("hours")},s.asHours=function(){return this.as("hours")},s.days=function(){return this.get("days")},s.asDays=function(){return this.as("days")},s.weeks=function(){return this.get("weeks")},s.asWeeks=function(){return this.as("weeks")},s.months=function(){return this.get("months")},s.asMonths=function(){return this.as("months")},s.years=function(){return this.get("years")},s.asYears=function(){return this.as("years")},l}(),R=function(l,s,t){return l.add(s.years()*t,"y").add(s.months()*t,"M").add(s.days()*t,"d").add(s.hours()*t,"h").add(s.minutes()*t,"m").add(s.seconds()*t,"s").add(s.milliseconds()*t,"ms")};return function(l,s,t){g=t,n=t().$utils(),t.duration=function(a,i){var d=t.locale();return S(a,{$l:d},i)},t.isDuration=Y;var e=s.prototype.add,o=s.prototype.subtract;s.prototype.add=function(a,i){return Y(a)?R(this,a,1):e.bind(this)(a,i)},s.prototype.subtract=function(a,i){return Y(a)?R(this,a,-1):o.bind(this)(a,i)}}})})(Q);var it=Q.exports;const rt={key:0,class:"bg-white rounded-xl shadow-sm border border-gray-100 p-4 mb-4"},lt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},dt={class:"flex flex-col justify-center items-start space-y-4"},ct={class:"text-xl font-bold text-gray-900 leading-tight"},ut={class:"text-sm text-gray-500 mt-1"},mt={key:0,class:"w-full"},ht={class:"mt-4 flex items-center space-x-2"},ft={key:0,class:"flex items-center text-green-600 font-medium"},gt={key:1,class:"flex items-center text-gray-500 font-medium"},vt={class:"bg-gray-50 rounded-lg p-4 border border-gray-100 flex flex-col justify-center space-y-4"},_t={class:"text-right border-b border-gray-200 pb-2"},pt={class:"text-2xl font-bold text-gray-800"},yt={class:"text-base text-gray-500 uppercase tracking-wide"},xt={class:"text-xs text-gray-400 mt-1"},$t={class:"grid grid-cols-2 gap-3"},bt={class:"bg-white p-3 rounded shadow-sm border border-gray-100"},wt={class:"text-[10px] uppercase font-bold text-gray-400 tracking-wider mb-1"},kt={class:"text-xl font-mono font-semibold text-gray-800"},Mt={class:"bg-white p-3 rounded shadow-sm border border-gray-100"},Yt={class:"text-[10px] uppercase font-bold text-gray-400 tracking-wider mb-1"},St={class:"text-xl font-mono font-semibold text-gray-500"},Dt={class:"text-xs text-center text-gray-400"},Ht={class:"flex flex-col items-center justify-center gap-4 py-6"},jt={class:"text-center"},Nt={class:"font-bold text-3xl mb-1"},It={class:"font-medium text-gray-500"},Tt={key:0,class:"w-full"},Ot={key:0,class:"font-medium text-gray-500 text-sm mb-2 text-center"},Ct={key:1,class:"rounded overflow-hidden w-full h-48 border bg-gray-50"},Lt=["src"],Et={key:2,class:"h-48 bg-gray-100 flex items-center justify-center text-gray-400 rounded"},Pt="Employee Checkin",zt={__name:"CheckInWidget",setup(L){m.locale("es"),m.extend(it);const T=e=>m(e).format("HH:mm"),g=e=>{const o=m.duration(e,"seconds"),a=Math.floor(o.asHours()),i=o.minutes(),d=o.seconds();return`${a.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}`},n=(e,o)=>{if(!e)return"";let a=e;return o&&o.length&&o.forEach((i,d)=>{a=a.replace(`{${d}}`,i)}),a},y=I(null),x=I(0),$=I(0),h=I(""),v=I(!1),b=I(!1),O=I(0),z=I(0);let M=null;const Y=V({url:"hrms.api.get_current_employee_info",auto:!0}),S=V({url:"hrms.api.get_hr_settings",auto:!0}),u=tt({doctype:Pt,fields:["name","log_type","time"],orderBy:"time desc",pageLength:50,auto:!1});q(()=>Y.data,e=>{e&&e.name&&(u.filters={employee:e.name,time:[">=",m().startOf("day").format("YYYY-MM-DD HH:mm:ss")]},u.reload())});const D=W(()=>u.list.loading||!u.data||u.data.length===0?null:u.data[0]),H=W(()=>D.value&&D.value.log_type==="IN"?"check-in":"check-out"),N=W(()=>!D.value||D.value.log_type==="OUT"?{action:"IN",label:n("Entrar")}:{action:"OUT",label:n("Salir")}),j=()=>{if(!u.data)return;const e=[...u.data].sort((p,B)=>new Date(p.time)-new Date(B.time));let o=0,a=0,i=null,d=null;e.forEach((p,B)=>{p.log_type==="IN"?(d&&(a+=m(p.time).diff(d,"second"),d=null),i=m(p.time)):p.log_type==="OUT"&&(i&&(o+=m(p.time).diff(i,"second"),i=null),d=m(p.time))});const _=m();i&&(o+=_.diff(i,"second")),O.value=o,z.value=a};et(()=>{M=setInterval(()=>{j()},1e3)}),st(()=>{M&&clearInterval(M)}),q(()=>u.data,()=>{j()});const F=e=>{x.value=e.coords.latitude,$.value=e.coords.longitude,h.value=[n("Latitud: {0}\xB0",[Number(x.value).toFixed(5)]),n("Longitud: {0}\xB0",[Number($.value).toFixed(5)])].join(", ")},R=e=>{h.value="No se pudo obtener tu ubicaci\xF3n",e&&(h.value+=`: ERROR(${e.code}): ${e.message}`)},l=()=>{navigator.geolocation?(h.value=n("Localizando..."),navigator.geolocation.getCurrentPosition(F,R)):h.value=n("Geolocalizaci\xF3n no soportada por tu navegador")},s=()=>{var e;y.value=m().format("YYYY-MM-DD HH:mm:ss"),v.value=!0,((e=S.data)==null?void 0:e.allow_geolocation_tracking)&&l()},t=e=>J(this,null,function*(){const o=n(e==="IN"?"Entrada":"Salida");b.value=!0;try{yield u.insert.submit({employee:Y.data.name,log_type:e,time:y.value,latitude:x.value,longitude:$.value}),K({title:n("\xC9xito"),text:n("\xA1{0} registrada correctamente!",[o]),icon:"check-circle",position:"bottom-center",iconClasses:"text-green-500"}),v.value=!1,u.reload()}catch(a){K({title:n("Error"),text:n("\xA1Fallo al registrar {0}!",[o]),icon:"alert-circle",position:"bottom-center",iconClasses:"text-red-500"}),console.error(a)}finally{b.value=!1}});return(e,o)=>{var a;return f(Y).data?(w(),k("div",rt,[r("div",lt,[r("div",dt,[r("div",null,[r("h2",ct,c(n("Hola, {0} \u{1F44B}",[f(Y).data.first_name])),1),r("p",ut,c(n("Registra tu jornada laboral")),1)]),((a=f(S).data)==null?void 0:a.allow_employee_checkin_from_mobile_app)?(w(),k("div",mt,[C(f(G),{size:"lg",variant:"solid",theme:N.value.action==="IN"?"green":"gray",onClick:s,class:"!px-6 !py-2 !text-base shadow-md w-full md:w-auto justify-center"},{prefix:E(()=>[C(f(ot),{name:N.value.action==="IN"?"log-in":"log-out",class:"w-6 h-6 mr-2"},null,8,["name"])]),default:E(()=>[A(" "+c(N.value.label),1)]),_:1},8,["theme"]),r("div",ht,[H.value==="check-in"?(w(),k("div",ft,[o[2]||(o[2]=r("span",{class:"relative flex h-3 w-3 mr-2"},[r("span",{class:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),r("span",{class:"relative inline-flex rounded-full h-3 w-3 bg-green-500"})],-1)),A(" "+c(n("Actualmente Trabajando")),1)])):(w(),k("div",gt,[o[3]||(o[3]=r("span",{class:"h-3 w-3 rounded-full bg-gray-300 mr-2"},null,-1)),A(" "+c(n("Jornada Pausada / No iniciada")),1)]))])])):P("",!0)]),r("div",vt,[r("div",_t,[r("div",pt,c(f(m)().format("D")),1),r("div",yt,c(f(m)().format("MMMM YYYY")),1),r("div",xt,c(f(m)().format("dddd")),1)]),r("div",$t,[r("div",bt,[r("div",wt,c(n("Tiempo Trabajado")),1),r("div",kt,c(g(O.value)),1)]),r("div",Mt,[r("div",Yt,c(n("Tiempo Descanso")),1),r("div",St,c(g(z.value)),1)])]),r("div",Dt,c(n("\xDAltimo registro: {0}",[D.value?T(D.value.time):"--:--"])),1)])]),C(f(nt),{modelValue:v.value,"onUpdate:modelValue":o[1]||(o[1]=i=>v.value=i),options:{title:N.value.label,size:"md"}},{"body-content":E(()=>{var i;return[r("div",Ht,[r("div",jt,[r("div",Nt,c(f(m)(y.value).format("HH:mm:ss")),1),r("div",It,c(f(m)().format("D MMM, YYYY")),1)]),((i=f(S).data)==null?void 0:i.allow_geolocation_tracking)?(w(),k("div",Tt,[h.value?(w(),k("div",Ot,c(h.value),1)):P("",!0),x.value&&$.value?(w(),k("div",Ct,[r("iframe",{width:"100%",height:"100%",frameborder:"0",scrolling:"no",marginheight:"0",marginwidth:"0",style:{border:"0"},src:`https://maps.google.com/maps?q=${x.value},${$.value}&hl=es&z=15&output=embed`},null,8,Lt)])):(w(),k("div",Et,c(n("Obteniendo ubicaci\xF3n...")),1))])):P("",!0)])]}),actions:E(()=>[C(f(G),{variant:"solid",class:"w-full",size:"lg",loading:b.value,onClick:o[0]||(o[0]=i=>t(N.value.action))},{default:E(()=>[A(c(n("Confirmar {0}",[N.value.label])),1)]),_:1},8,["loading"])]),_:1},8,["modelValue","options"])])):P("",!0)}}},Ft={class:"flex flex-col h-full overflow-hidden"},Rt={class:"flex-1 overflow-y-auto p-5"},Bt={key:0},At={class:"text-lg font-semibold text-gray-800 mb-4"},qt={__name:"Fichaje",setup(L){const T=n=>n,g=V({url:"hrms.api.get_current_employee_info",auto:!0});return(n,y)=>(w(),k("div",Ft,[r("div",Rt,[C(zt),f(g).data?(w(),k("div",Bt,[r("h3",At,c(T("Mi Asistencia")),1),C(at,{employeeId:f(g).data.name},null,8,["employeeId"])])):P("",!0)])]))}};export{qt as default};
