var K=(G,O,V)=>new Promise((U,M)=>{var y=p=>{try{b(V.next(p))}catch(u){M(u)}},f=p=>{try{b(V.throw(p))}catch(u){M(u)}},b=p=>p.done?U(p.value):Promise.resolve(p.value).then(y,f);b((V=V.apply(G,O)).next())});import{a1 as we,z as Me,r as E,K as De,q as pe,a8 as Ye,o as T,c as R,b as a,t as l,s as fe,w as Z,u as x,Q as W,f as N,d as k,a4 as ke,a5 as he,e as C,F as Ve,E as Se,J as $e,ab as Le,aa as de,G as Te,n as ue,C as He,R as ee}from"./vendor.0086aa74.js";import{d as H}from"./es.72676fb6.js";var _e={exports:{}};(function(G,O){(function(V,U){G.exports=U()})(we,function(){var V={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},U=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|Q|YYYY|YY?|ww?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,M=/\d/,y=/\d\d/,f=/\d\d?/,b=/\d*[^-_:/,()\s\d]+/,p={},u=function(o){return(o=+o)+(o>68?1900:2e3)},n=function(o){return function(d){this[o]=+d}},j=[/[+-]\d\d:?(\d\d)?|Z/,function(o){(this.zone||(this.zone={})).offset=function(d){if(!d||d==="Z")return 0;var c=d.match(/([+-]|\d\d)/g),m=60*c[1]+(+c[2]||0);return m===0?0:c[0]==="+"?-m:m}(o)}],z=function(o){var d=p[o];return d&&(d.indexOf?d:d.s.concat(d.f))},B=function(o,d){var c,m=p.meridiem;if(m){for(var D=1;D<=24;D+=1)if(o.indexOf(m(D,0,d))>-1){c=D>12;break}}else c=o===(d?"pm":"PM");return c},q={A:[b,function(o){this.afternoon=B(o,!1)}],a:[b,function(o){this.afternoon=B(o,!0)}],Q:[M,function(o){this.month=3*(o-1)+1}],S:[M,function(o){this.milliseconds=100*+o}],SS:[y,function(o){this.milliseconds=10*+o}],SSS:[/\d{3}/,function(o){this.milliseconds=+o}],s:[f,n("seconds")],ss:[f,n("seconds")],m:[f,n("minutes")],mm:[f,n("minutes")],H:[f,n("hours")],h:[f,n("hours")],HH:[f,n("hours")],hh:[f,n("hours")],D:[f,n("day")],DD:[y,n("day")],Do:[b,function(o){var d=p.ordinal,c=o.match(/\d+/);if(this.day=c[0],d)for(var m=1;m<=31;m+=1)d(m).replace(/\[|\]/g,"")===o&&(this.day=m)}],w:[f,n("week")],ww:[y,n("week")],M:[f,n("month")],MM:[y,n("month")],MMM:[b,function(o){var d=z("months"),c=(z("monthsShort")||d.map(function(m){return m.slice(0,3)})).indexOf(o)+1;if(c<1)throw new Error;this.month=c%12||c}],MMMM:[b,function(o){var d=z("months").indexOf(o)+1;if(d<1)throw new Error;this.month=d%12||d}],Y:[/[+-]?\d+/,n("year")],YY:[y,function(o){this.year=u(o)}],YYYY:[/\d{4}/,n("year")],Z:j,ZZ:j};function te(o){var d,c;d=o,c=p&&p.formats;for(var m=(o=d.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(A,i,t){var e=t&&t.toUpperCase();return i||c[t]||V[t]||c[e].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(r,s,h){return s||h.slice(1)})})).match(U),D=m.length,w=0;w<D;w+=1){var I=m[w],S=q[I],$=S&&S[0],Y=S&&S[1];m[w]=Y?{regex:$,parser:Y}:I.replace(/^\[|\]$/g,"")}return function(A){for(var i={},t=0,e=0;t<D;t+=1){var r=m[t];if(typeof r=="string")e+=r.length;else{var s=r.regex,h=r.parser,v=A.slice(e),L=s.exec(v)[0];h.call(i,L),A=A.replace(L,"")}}return function(g){var F=g.afternoon;if(F!==void 0){var _=g.hours;F?_<12&&(g.hours+=12):_===12&&(g.hours=0),delete g.afternoon}}(i),i}}return function(o,d,c){c.p.customParseFormat=!0,o&&o.parseTwoDigitYear&&(u=o.parseTwoDigitYear);var m=d.prototype,D=m.parse;m.parse=function(w){var I=w.date,S=w.utc,$=w.args;this.$u=S;var Y=$[1];if(typeof Y=="string"){var A=$[2]===!0,i=$[3]===!0,t=A||i,e=$[2];i&&(e=$[2]),p=this.$locale(),!A&&e&&(p=c.Ls[e]),this.$d=function(v,L,g,F){try{if(["x","X"].indexOf(L)>-1)return new Date((L==="X"?1e3:1)*v);var _=te(L)(v),P=_.year,Q=_.month,ve=_.day,ge=_.hours,xe=_.minutes,ye=_.seconds,be=_.milliseconds,ce=_.zone,me=_.week,ae=new Date,se=ve||(P||Q?1:ae.getDate()),oe=P||ae.getFullYear(),X=0;P&&!Q||(X=Q>0?Q-1:ae.getMonth());var J,re=ge||0,ne=xe||0,le=ye||0,ie=be||0;return ce?new Date(Date.UTC(oe,X,se,re,ne,le,ie+60*ce.offset*1e3)):g?new Date(Date.UTC(oe,X,se,re,ne,le,ie)):(J=new Date(oe,X,se,re,ne,le,ie),me&&(J=F(J).week(me).toDate()),J)}catch(Ut){return new Date("")}}(I,Y,S,c),this.init(),e&&e!==!0&&(this.$L=this.locale(e).$L),t&&I!=this.format(Y)&&(this.$d=new Date("")),p={}}else if(Y instanceof Array)for(var r=Y.length,s=1;s<=r;s+=1){$[1]=Y[s-1];var h=c.apply(this,$);if(h.isValid()){this.$d=h.$d,this.$L=h.$L,this.init();break}s===r&&(this.$d=new Date(""))}else D.call(this,w)}}})})(_e);var Ue=_e.exports;const Ee={class:"flex flex-col h-full overflow-hidden bg-white"},Ce={class:"flex-1 overflow-y-auto p-5"},Ie={class:"mb-6 flex items-center justify-between"},Ae={class:"text-2xl font-bold text-gray-900"},Fe={class:"flex items-center space-x-2"},Re={class:"bg-gray-50 rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},Oe={class:"grid grid-cols-12 gap-4 items-end"},Ne={class:"col-span-12 md:col-span-4"},Pe={class:"block text-sm font-medium text-gray-700 mb-1"},je={class:"col-span-6 md:col-span-3"},ze={class:"block text-sm font-medium text-gray-700 mb-1"},Be={class:"col-span-6 md:col-span-3"},Ze={class:"block text-sm font-medium text-gray-700 mb-1"},Ge={class:"col-span-12 md:col-span-2"},qe={key:0,class:"bg-white rounded-lg border border-gray-200 shadow-sm p-6",id:"printable-area"},Qe={class:"border-b border-gray-200 pb-4 mb-4 flex flex-col md:flex-row justify-between items-start md:items-end gap-4"},Xe={class:"text-xl font-bold text-gray-900"},Je={class:"flex flex-wrap gap-4 mt-2 text-sm text-gray-600"},Ke={key:0},We={class:"bg-blue-50 text-blue-800 text-xs p-3 rounded-md max-w-md"},et={class:"font-semibold mb-1 flex items-center"},tt={class:"overflow-x-auto"},at={class:"min-w-full divide-y divide-gray-200"},st={class:"bg-gray-50"},ot={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},rt={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},nt={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},lt={scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},it={scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},dt={scope:"col",class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider no-print"},ut={class:"bg-white divide-y divide-gray-200"},ct={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},mt={class:"flex items-center gap-2"},pt={key:0,class:"text-xs text-orange-600 font-medium"},ft={key:1,class:"no-print"},ht={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},_t={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},vt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right"},gt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right font-medium"},xt={class:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium no-print"},yt={class:"bg-gray-50"},bt={colspan:"3",class:"px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900 text-right"},wt={class:"px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900 text-right"},Mt={key:1,class:"text-center py-10 text-gray-500"},Dt={key:0,class:"space-y-4"},Yt={class:"text-sm text-gray-600 mb-4"},kt={class:"font-bold"},Vt={class:"grid grid-cols-2 gap-4"},St={class:"block text-sm font-medium text-gray-700 mb-1"},$t={class:"block text-sm font-medium text-gray-700 mb-1"},Lt={class:"block text-sm font-medium text-gray-700 mb-1"},Tt={class:"block text-sm font-medium text-gray-700 mb-1"},Ht={__name:"AttendanceReport",setup(G){H.extend(Ue),H.locale("es");const O=E([]),V=E(!1),U=E(!1),M=E([]),y=E(null),f=E(!1),b=E(!1),p=E(null),u=E({total_hours:0,rest_time:"",verified_in_time:"",verified_out_time:""});De(()=>[u.value.total_hours,u.value.verified_in_time,u.value.verified_out_time],([t,e,r])=>{if(!f.value||!e||!r)return;const s=H(e,"HH:mm"),h=H(r,"HH:mm");if(!s.isValid()||!h.isValid())return;const v=h.diff(s,"minute");if(v<=0)return;const L=Math.min(parseFloat(t||0)*60,v),g=v-L;if(g>=0){const F=Math.floor(g/60),_=Math.round(g%60);u.value.rest_time=`${String(F).padStart(2,"0")}:${String(_).padStart(2,"0")}`}});const n=E({employee:null,from_date:H().startOf("month").format("YYYY-MM-DD"),to_date:H().endOf("month").format("YYYY-MM-DD")}),j=pe(()=>n.value.employee&&n.value.from_date&&n.value.to_date),z=pe(()=>M.value.reduce((t,e)=>t+(e.hours||0),0)),B=Le(t=>K(this,null,function*(){try{const e=yield de("portal_rrhh.portal_rrhh.employee_data.get_employees_list",{search_term:t});O.value=(e.employees||[]).map(r=>{const s=r.status||"Sin estado",h=r.custom_dninie||"Sin DNI";return{label:`${r.employee_name} (${h})`,value:r.name,original:r}})}catch(e){console.error("Search failed:",e)}}),300),q=()=>K(this,null,function*(){var t,e;if(!!j.value){V.value=!0,U.value=!1;try{let r=n.value.employee.label||"";if(!r&&O.value.length){const h=O.value.find(v=>v.value===n.value.employee.value);h&&(r=h.label)}y.value={employee_name:((t=r.split("(")[0])==null?void 0:t.trim())||"Empleado",dni:((e=r.match(/\((.*?)\)/))==null?void 0:e[1])||""};const s=yield de("portal_rrhh.api.attendance.get_attendance_report",{employee:n.value.employee.value,from_date:n.value.from_date,to_date:n.value.to_date});s&&s.success&&s.data?(M.value=s.data,U.value=!0):M.value=[]}catch(r){console.error(r)}finally{V.value=!1}}}),te=()=>{window.print()},o=()=>{const t=new URLSearchParams({employee:n.value.employee.value,from_date:n.value.from_date,to_date:n.value.to_date});window.open(`/api/method/portal_rrhh.api.attendance.export_attendance_report?${t.toString()}`,"_blank")},d=t=>{p.value=t;const e=w(t.logs),r=I(t.logs);u.value={total_hours:t.hours,rest_time:t.verified_rest_time||(S(t.logs)!=="-"?S(t.logs):""),verified_in_time:e!=="-"?e:"",verified_out_time:r!=="-"?r:""},f.value=!0},c=()=>K(this,null,function*(){if(!!p.value){b.value=!0;try{const t=yield de("portal_rrhh.api.attendance.save_verified_attendance",{employee:n.value.employee.value,date:p.value.date,total_hours:u.value.total_hours,in_time:u.value.verified_in_time,out_time:u.value.verified_out_time,rest_time:u.value.rest_time});t&&t.success?(f.value=!1,q()):(console.error(t.message),alert(t.message||"Error al guardar"))}catch(t){console.error(t),alert("Error al guardar")}finally{b.value=!1}}}),m=t=>t?H(t).format("DD/MM/YYYY"):"",D=t=>H(t).format("DD MMMM YYYY (dddd)"),w=t=>{if(!t||!t.length)return"-";const e=t.filter(r=>r.type==="IN");return e.length?e[0].time:"Usuario no registr\xF3 hora de entrada"},I=t=>{if(!t||!t.length)return"-";const e=t.filter(r=>r.type==="OUT");return e.length?e[e.length-1].time:"Usuario no registr\xF3 hora de salida"},S=t=>{if(!t||t.length<2)return"-";let e=0;for(let v=0;v<t.length-1;v++){const L=t[v],g=t[v+1];if(L.type==="OUT"&&g.type==="IN"){const F=H(L.time,"HH:mm"),_=H(g.time,"HH:mm");if(_.isValid()&&F.isValid()){const P=_.diff(F,"minute");P>0&&(e+=P)}}}if(e===0)return"-";const r=Math.floor(Math.abs(e)/60),s=Math.round(Math.abs(e)%60);return`${e<0?"-":""}${String(r).padStart(2,"0")}:${String(s).padStart(2,"0")}`},$=t=>{if(!t||t==="-")return"-";const e=t.match(/(\d+)h\s*(\d+)m/);if(e){const r=parseInt(e[1])||0,s=parseInt(e[2])||0;return`${String(r).padStart(2,"0")}:${String(s).padStart(2,"0")}`}return t},Y=t=>{if(!t)return"00:00";const e=Math.floor(t),r=Math.round((t-e)*60);return`${String(e).padStart(2,"0")}:${String(r).padStart(2,"0")}`},A=t=>{if(t.is_verified)return"bg-blue-50/50";if(t.hours>0)return"";if(t.status)return"bg-orange-50";const e=H(t.date).day();return e===0||e===6?"bg-gray-50 text-gray-400":"bg-red-50"},i=t=>t;return Ye(()=>{B("")}),(t,e)=>{const r=Te("FeatherIcon");return T(),R("div",Ee,[a("div",Ce,[a("div",Ie,[a("h1",Ae,l(i("Reporte de Asistencia")),1),a("div",Fe,[M.value.length?(T(),fe(x(W),{key:0,variant:"outline",onClick:te},{default:Z(()=>[C(l(i("Imprimir / PDF")),1)]),_:1})):N("",!0),M.value.length?(T(),fe(x(W),{key:1,variant:"outline",onClick:o},{default:Z(()=>[C(l(i("Exportar Excel")),1)]),_:1})):N("",!0)])]),a("div",Re,[a("div",Oe,[a("div",Ne,[a("label",Pe,l(i("Empleado")),1),k(x(ke),{modelValue:n.value.employee,"onUpdate:modelValue":e[0]||(e[0]=s=>n.value.employee=s),options:O.value,placeholder:"Buscar por nombre, DNI o ID...","onUpdate:query":x(B)},null,8,["modelValue","options","onUpdate:query"])]),a("div",je,[a("label",ze,l(i("Desde")),1),k(x(he),{modelValue:n.value.from_date,"onUpdate:modelValue":e[1]||(e[1]=s=>n.value.from_date=s),class:"w-full"},null,8,["modelValue"])]),a("div",Be,[a("label",Ze,l(i("Hasta")),1),k(x(he),{modelValue:n.value.to_date,"onUpdate:modelValue":e[2]||(e[2]=s=>n.value.to_date=s),class:"w-full"},null,8,["modelValue"])]),a("div",Ge,[k(x(W),{variant:"solid",theme:"gray",class:"w-full justify-center !bg-black !text-white hover:!bg-gray-800",loading:V.value,disabled:!j.value,onClick:q},{default:Z(()=>[C(l(i("Generar Reporte")),1)]),_:1},8,["loading","disabled"])])])]),U.value&&y.value?(T(),R("div",qe,[a("div",Qe,[a("div",null,[a("h2",Xe,l(y.value.employee_name),1),a("div",Je,[y.value.dni?(T(),R("div",Ke,[e[8]||(e[8]=a("span",{class:"font-semibold"},"DNI/NIE:",-1)),C(" "+l(y.value.dni),1)])):N("",!0),a("div",null,[e[9]||(e[9]=a("span",{class:"font-semibold"},"Periodo:",-1)),C(" "+l(m(n.value.from_date))+" - "+l(m(n.value.to_date)),1)])])]),a("div",We,[a("div",et,[k(r,{name:"info",class:"w-3 h-3 mr-1"}),C(" "+l(i("C\xE1lculo de Horas")),1)]),C(" "+l(i('El "Total Horas" representa la suma real de tiempo trabajado (suma de intervalos Entrada-Salida), excluyendo descansos no fichados.')),1)])]),a("div",tt,[a("table",at,[a("thead",st,[a("tr",null,[a("th",ot,l(i("Fecha")),1),a("th",rt,l(i("Hora Entrada")),1),a("th",nt,l(i("Hora Salida")),1),a("th",lt,l(i("Tiempo Descanso")),1),a("th",it,l(i("Total Horas")),1),a("th",dt,l(i("Acciones")),1)])]),a("tbody",ut,[(T(!0),R(Ve,null,Se(M.value,s=>(T(),R("tr",{key:s.date,class:ue(A(s))},[a("td",ct,[a("div",mt,[C(l(D(s.date))+" ",1),s.status&&s.hours===0?(T(),R("div",pt,l(s.status),1)):N("",!0),s.is_verified?(T(),R("div",ft,[k(x(He),{theme:"blue",size:"sm"},{default:Z(()=>[C(l(i("Verificado")),1)]),_:1})])):N("",!0)])]),a("td",ht,[a("span",{class:ue({"text-red-500 text-xs":w(s.logs).includes("Usuario")})},l(w(s.logs)),3)]),a("td",_t,[a("span",{class:ue({"text-red-500 text-xs":I(s.logs).includes("Usuario")})},l(I(s.logs)),3)]),a("td",vt,l($(s.verified_rest_time||S(s.logs))),1),a("td",gt,l(Y(s.hours)),1),a("td",xt,[k(x(W),{icon:"edit-2",variant:"ghost",onClick:h=>d(s)},null,8,["onClick"])])],2))),128))]),a("tfoot",yt,[a("tr",null,[a("td",bt,l(i("Total Periodo:")),1),e[10]||(e[10]=a("td",{class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-500 text-right"},null,-1)),a("td",wt,l(Y(z.value)),1),e[11]||(e[11]=a("td",null,null,-1))])])])])])):U.value?N("",!0):(T(),R("div",Mt,l(i("Selecciona un empleado y un rango de fechas para generar el reporte.")),1)),k(x($e),{modelValue:f.value,"onUpdate:modelValue":e[7]||(e[7]=s=>f.value=s),options:{title:i("Verificar / Corregir Asistencia"),actions:[{label:i("Guardar"),variant:"solid",loading:b.value,onClick:c}]}},{"body-content":Z(()=>[p.value?(T(),R("div",Dt,[a("div",Yt,[C(l(i("Editando registro del:"))+" ",1),a("span",kt,l(D(p.value.date)),1)]),a("div",Vt,[a("div",null,[a("label",St,l(i("Total Horas"))+" *",1),k(x(ee),{type:"number",step:"0.01",modelValue:u.value.total_hours,"onUpdate:modelValue":e[3]||(e[3]=s=>u.value.total_hours=s),placeholder:"0.00"},null,8,["modelValue"])]),a("div",null,[a("label",$t,l(i("Tiempo Descanso")),1),k(x(ee),{type:"text",modelValue:u.value.rest_time,"onUpdate:modelValue":e[4]||(e[4]=s=>u.value.rest_time=s),placeholder:"Ej: 01:30"},null,8,["modelValue"])]),a("div",null,[a("label",Lt,l(i("Hora Entrada (Visual)")),1),k(x(ee),{type:"time",modelValue:u.value.verified_in_time,"onUpdate:modelValue":e[5]||(e[5]=s=>u.value.verified_in_time=s)},null,8,["modelValue"])]),a("div",null,[a("label",Tt,l(i("Hora Salida (Visual)")),1),k(x(ee),{type:"time",modelValue:u.value.verified_out_time,"onUpdate:modelValue":e[6]||(e[6]=s=>u.value.verified_out_time=s)},null,8,["modelValue"])])])])):N("",!0)]),_:1},8,["modelValue","options"])])])}}};var At=Me(Ht,[["__scopeId","data-v-30b711dc"]]);export{At as default};
