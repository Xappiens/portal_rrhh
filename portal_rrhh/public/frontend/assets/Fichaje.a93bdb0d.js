var G=(F,E,b)=>new Promise((r,_)=>{var w=$=>{try{x(b.next($))}catch(Y){_(Y)}},k=$=>{try{x(b.throw($))}catch(Y){_(Y)}},x=$=>$.done?r($.value):Promise.resolve($.value).then(w,k);x((b=b.apply(F,E)).next())});import{a3 as nt,r as H,l as K,a6 as rt,K as Q,q as R,X as it,a7 as lt,u as y,o as u,c as f,b as s,t as c,d as z,w as P,_ as X,e as V,Q as Z,f as D,J as dt,a8 as tt,F as A,E as U,n as J,s as et,C as st,a1 as ct}from"./vendor.b007e8f2.js";import{d as p}from"./es.57c2289d.js";var ot={exports:{}};(function(F,E){(function(b,r){F.exports=r()})(nt,function(){var b,r,_=1e3,w=6e4,k=36e5,x=864e5,$=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,Y=31536e6,L=2628e6,B=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,j={years:Y,months:L,days:x,hours:k,minutes:w,seconds:_,milliseconds:1,weeks:6048e5},T=function(i){return i instanceof S},C=function(i,a,t){return new S(i,t,a.$l)},v=function(i){return r.p(i)+"s"},N=function(i){return i<0},m=function(i){return N(i)?Math.ceil(i):Math.floor(i)},h=function(i){return Math.abs(i)},o=function(i,a){return i?N(i)?{negative:!0,format:""+h(i)+a}:{negative:!1,format:""+i+a}:{negative:!1,format:""}},S=function(){function i(t,e,n){var l=this;if(this.$d={},this.$l=n,t===void 0&&(this.$ms=0,this.parseFromMilliseconds()),e)return C(t*j[v(e)],this);if(typeof t=="number")return this.$ms=t,this.parseFromMilliseconds(),this;if(typeof t=="object")return Object.keys(t).forEach(function(O){l.$d[v(O)]=t[O]}),this.calMilliseconds(),this;if(typeof t=="string"){var d=t.match(B);if(d){var g=d.slice(2).map(function(O){return O!=null?Number(O):0});return this.$d.years=g[0],this.$d.months=g[1],this.$d.weeks=g[2],this.$d.days=g[3],this.$d.hours=g[4],this.$d.minutes=g[5],this.$d.seconds=g[6],this.calMilliseconds(),this}}return this}var a=i.prototype;return a.calMilliseconds=function(){var t=this;this.$ms=Object.keys(this.$d).reduce(function(e,n){return e+(t.$d[n]||0)*j[n]},0)},a.parseFromMilliseconds=function(){var t=this.$ms;this.$d.years=m(t/Y),t%=Y,this.$d.months=m(t/L),t%=L,this.$d.days=m(t/x),t%=x,this.$d.hours=m(t/k),t%=k,this.$d.minutes=m(t/w),t%=w,this.$d.seconds=m(t/_),t%=_,this.$d.milliseconds=t},a.toISOString=function(){var t=o(this.$d.years,"Y"),e=o(this.$d.months,"M"),n=+this.$d.days||0;this.$d.weeks&&(n+=7*this.$d.weeks);var l=o(n,"D"),d=o(this.$d.hours,"H"),g=o(this.$d.minutes,"M"),O=this.$d.seconds||0;this.$d.milliseconds&&(O+=this.$d.milliseconds/1e3,O=Math.round(1e3*O)/1e3);var I=o(O,"S"),W=t.negative||e.negative||l.negative||d.negative||g.negative||I.negative,at=d.format||g.format||I.format?"T":"",q=(W?"-":"")+"P"+t.format+e.format+l.format+at+d.format+g.format+I.format;return q==="P"||q==="-P"?"P0D":q},a.toJSON=function(){return this.toISOString()},a.format=function(t){var e=t||"YYYY-MM-DDTHH:mm:ss",n={Y:this.$d.years,YY:r.s(this.$d.years,2,"0"),YYYY:r.s(this.$d.years,4,"0"),M:this.$d.months,MM:r.s(this.$d.months,2,"0"),D:this.$d.days,DD:r.s(this.$d.days,2,"0"),H:this.$d.hours,HH:r.s(this.$d.hours,2,"0"),m:this.$d.minutes,mm:r.s(this.$d.minutes,2,"0"),s:this.$d.seconds,ss:r.s(this.$d.seconds,2,"0"),SSS:r.s(this.$d.milliseconds,3,"0")};return e.replace($,function(l,d){return d||String(n[l])})},a.as=function(t){return this.$ms/j[v(t)]},a.get=function(t){var e=this.$ms,n=v(t);return n==="milliseconds"?e%=1e3:e=n==="weeks"?m(e/j[n]):this.$d[n],e||0},a.add=function(t,e,n){var l;return l=e?t*j[v(e)]:T(t)?t.$ms:C(t,this).$ms,C(this.$ms+l*(n?-1:1),this)},a.subtract=function(t,e){return this.add(t,e,!0)},a.locale=function(t){var e=this.clone();return e.$l=t,e},a.clone=function(){return C(this.$ms,this)},a.humanize=function(t){return b().add(this.$ms,"ms").locale(this.$l).fromNow(!t)},a.valueOf=function(){return this.asMilliseconds()},a.milliseconds=function(){return this.get("milliseconds")},a.asMilliseconds=function(){return this.as("milliseconds")},a.seconds=function(){return this.get("seconds")},a.asSeconds=function(){return this.as("seconds")},a.minutes=function(){return this.get("minutes")},a.asMinutes=function(){return this.as("minutes")},a.hours=function(){return this.get("hours")},a.asHours=function(){return this.as("hours")},a.days=function(){return this.get("days")},a.asDays=function(){return this.as("days")},a.weeks=function(){return this.get("weeks")},a.asWeeks=function(){return this.as("weeks")},a.months=function(){return this.get("months")},a.asMonths=function(){return this.as("months")},a.years=function(){return this.get("years")},a.asYears=function(){return this.as("years")},i}(),M=function(i,a,t){return i.add(a.years()*t,"y").add(a.months()*t,"M").add(a.days()*t,"d").add(a.hours()*t,"h").add(a.minutes()*t,"m").add(a.seconds()*t,"s").add(a.milliseconds()*t,"ms")};return function(i,a,t){b=t,r=t().$utils(),t.duration=function(l,d){var g=t.locale();return C(l,{$l:g},d)},t.isDuration=T;var e=a.prototype.add,n=a.prototype.subtract;a.prototype.add=function(l,d){return T(l)?M(this,l,1):e.bind(this)(l,d)},a.prototype.subtract=function(l,d){return T(l)?M(this,l,-1):n.bind(this)(l,d)}}})})(ot);var ut=ot.exports;const mt={key:0,class:"bg-white rounded-xl shadow-sm border border-gray-100 p-4 mb-4"},ht={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ft={class:"flex flex-col justify-center items-start space-y-4"},gt={class:"text-xl font-bold text-gray-900 leading-tight"},vt={class:"text-sm text-gray-500 mt-1"},pt={key:0,class:"w-full"},_t={class:"mt-4 flex items-center space-x-2"},yt={key:0,class:"flex items-center text-green-600 font-medium"},bt={key:1,class:"flex items-center text-gray-500 font-medium"},xt={class:"bg-gray-50 rounded-lg p-4 border border-gray-100 flex flex-col justify-center space-y-4"},$t={class:"text-right border-b border-gray-200 pb-2"},Mt={class:"text-2xl font-bold text-gray-800"},wt={class:"text-base text-gray-500 uppercase tracking-wide"},kt={class:"text-xs text-gray-400 mt-1"},Yt={class:"grid grid-cols-2 gap-3"},Dt={class:"bg-white p-3 rounded shadow-sm border border-gray-100"},St={class:"text-[10px] uppercase font-bold text-gray-400 tracking-wider mb-1"},jt={class:"text-xl font-mono font-semibold text-gray-800"},Tt={class:"bg-white p-3 rounded shadow-sm border border-gray-100"},Nt={class:"text-[10px] uppercase font-bold text-gray-400 tracking-wider mb-1"},Ot={class:"text-xl font-mono font-semibold text-gray-500"},It={class:"text-xs text-center text-gray-400"},Ct={class:"flex flex-col items-center justify-center gap-4 py-6"},Ht={class:"text-center"},Et={class:"font-bold text-3xl mb-1"},Lt={class:"font-medium text-gray-500"},zt={key:0,class:"w-full"},Ft={key:0,class:"font-medium text-gray-500 text-sm mb-2 text-center"},Bt={key:1,class:"rounded overflow-hidden w-full h-48 border bg-gray-50"},Pt=["src"],Rt={key:2,class:"h-48 bg-gray-100 flex items-center justify-center text-gray-400 rounded"},Vt="Employee Checkin",At={__name:"CheckInWidget",setup(F){p.locale("es"),p.extend(ut);const E=e=>p(e).format("HH:mm"),b=e=>{const n=p.duration(e,"seconds"),l=Math.floor(n.asHours()),d=n.minutes(),g=n.seconds();return`${l.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}:${g.toString().padStart(2,"0")}`},r=(e,n)=>{if(!e)return"";let l=e;return n&&n.length&&n.forEach((d,g)=>{l=l.replace(`{${g}}`,d)}),l},_=H(null),w=H(0),k=H(0),x=H(""),$=H(!1),Y=H(!1),L=H(0),B=H(0);let j=null;const T=K({url:"hrms.api.get_current_employee_info",auto:!0}),C=K({url:"hrms.api.get_hr_settings",auto:!0}),v=rt({doctype:Vt,fields:["name","log_type","time"],orderBy:"time desc",pageLength:50,auto:!1});Q(()=>T.data,e=>{e&&e.name&&(v.filters={employee:e.name,time:[">=",p().startOf("day").format("YYYY-MM-DD HH:mm:ss")]},v.reload())});const N=R(()=>v.list.loading||!v.data||v.data.length===0?null:v.data[0]),m=R(()=>N.value&&N.value.log_type==="IN"?"check-in":"check-out"),h=R(()=>!N.value||N.value.log_type==="OUT"?{action:"IN",label:r("Entrar")}:{action:"OUT",label:r("Salir")}),o=()=>{if(!v.data)return;const e=[...v.data].sort((I,W)=>new Date(I.time)-new Date(W.time));let n=0,l=0,d=null,g=null;e.forEach((I,W)=>{I.log_type==="IN"?(g&&(l+=p(I.time).diff(g,"second"),g=null),d=p(I.time)):I.log_type==="OUT"&&(d&&(n+=p(I.time).diff(d,"second"),d=null),g=p(I.time))});const O=p();d&&(n+=O.diff(d,"second")),L.value=n,B.value=l};it(()=>{j=setInterval(()=>{o()},1e3)}),lt(()=>{j&&clearInterval(j)}),Q(()=>v.data,()=>{o()});const S=e=>{w.value=e.coords.latitude,k.value=e.coords.longitude,x.value=[r("Latitud: {0}\xB0",[Number(w.value).toFixed(5)]),r("Longitud: {0}\xB0",[Number(k.value).toFixed(5)])].join(", ")},M=e=>{x.value="No se pudo obtener tu ubicaci\xF3n",e&&(x.value+=`: ERROR(${e.code}): ${e.message}`)},i=()=>{navigator.geolocation?(x.value=r("Localizando..."),navigator.geolocation.getCurrentPosition(S,M)):x.value=r("Geolocalizaci\xF3n no soportada por tu navegador")},a=()=>{var e;_.value=p().format("YYYY-MM-DD HH:mm:ss"),$.value=!0,((e=C.data)==null?void 0:e.allow_geolocation_tracking)&&i()},t=e=>G(this,null,function*(){const n=r(e==="IN"?"Entrada":"Salida");Y.value=!0;try{yield v.insert.submit({employee:T.data.name,log_type:e,time:_.value,latitude:w.value,longitude:k.value}),tt({title:r("\xC9xito"),text:r("\xA1{0} registrada correctamente!",[n]),icon:"check-circle",position:"bottom-center",iconClasses:"text-green-500"}),$.value=!1,v.reload()}catch(l){tt({title:r("Error"),text:r("\xA1Fallo al registrar {0}!",[n]),icon:"alert-circle",position:"bottom-center",iconClasses:"text-red-500"}),console.error(l)}finally{Y.value=!1}});return(e,n)=>{var l;return y(T).data?(u(),f("div",mt,[s("div",ht,[s("div",ft,[s("div",null,[s("h2",gt,c(r("Hola, {0} \u{1F44B}",[y(T).data.first_name])),1),s("p",vt,c(r("Registra tu jornada laboral")),1)]),((l=y(C).data)==null?void 0:l.allow_employee_checkin_from_mobile_app)?(u(),f("div",pt,[z(y(Z),{size:"lg",variant:"solid",theme:h.value.action==="IN"?"green":"gray",onClick:a,class:"!px-6 !py-2 !text-base shadow-md w-full md:w-auto justify-center"},{prefix:P(()=>[z(y(X),{name:h.value.action==="IN"?"log-in":"log-out",class:"w-6 h-6 mr-2"},null,8,["name"])]),default:P(()=>[V(" "+c(h.value.label),1)]),_:1},8,["theme"]),s("div",_t,[m.value==="check-in"?(u(),f("div",yt,[n[2]||(n[2]=s("span",{class:"relative flex h-3 w-3 mr-2"},[s("span",{class:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),s("span",{class:"relative inline-flex rounded-full h-3 w-3 bg-green-500"})],-1)),V(" "+c(r("Actualmente Trabajando")),1)])):(u(),f("div",bt,[n[3]||(n[3]=s("span",{class:"h-3 w-3 rounded-full bg-gray-300 mr-2"},null,-1)),V(" "+c(r("Jornada Pausada / No iniciada")),1)]))])])):D("",!0)]),s("div",xt,[s("div",$t,[s("div",Mt,c(y(p)().format("D")),1),s("div",wt,c(y(p)().format("MMMM YYYY")),1),s("div",kt,c(y(p)().format("dddd")),1)]),s("div",Yt,[s("div",Dt,[s("div",St,c(r("Tiempo Trabajado")),1),s("div",jt,c(b(L.value)),1)]),s("div",Tt,[s("div",Nt,c(r("Tiempo Descanso")),1),s("div",Ot,c(b(B.value)),1)])]),s("div",It,c(r("\xDAltimo registro: {0}",[N.value?E(N.value.time):"--:--"])),1)])]),z(y(dt),{modelValue:$.value,"onUpdate:modelValue":n[1]||(n[1]=d=>$.value=d),options:{title:h.value.label,size:"md"}},{"body-content":P(()=>{var d;return[s("div",Ct,[s("div",Ht,[s("div",Et,c(y(p)(_.value).format("HH:mm:ss")),1),s("div",Lt,c(y(p)().format("D MMM, YYYY")),1)]),((d=y(C).data)==null?void 0:d.allow_geolocation_tracking)?(u(),f("div",zt,[x.value?(u(),f("div",Ft,c(x.value),1)):D("",!0),w.value&&k.value?(u(),f("div",Bt,[s("iframe",{width:"100%",height:"100%",frameborder:"0",scrolling:"no",marginheight:"0",marginwidth:"0",style:{border:"0"},src:`https://maps.google.com/maps?q=${w.value},${k.value}&hl=es&z=15&output=embed`},null,8,Pt)])):(u(),f("div",Rt,c(r("Obteniendo ubicaci\xF3n...")),1))])):D("",!0)])]}),actions:P(()=>[z(y(Z),{variant:"solid",class:"w-full",size:"lg",loading:Y.value,onClick:n[0]||(n[0]=d=>t(h.value.action))},{default:P(()=>[V(c(r("Confirmar {0}",[h.value.label])),1)]),_:1},8,["loading"])]),_:1},8,["modelValue","options"])])):D("",!0)}}},Ut={class:"attendance-calendar"},Wt={class:"flex justify-end mb-4"},Jt={class:"flex items-center bg-white rounded-md shadow-sm border border-gray-300"},qt={class:"grid grid-cols-1 lg:grid-cols-2 gap-8 relative"},Gt={class:"bg-white"},Kt={class:"text-lg font-bold text-gray-900 mb-4 capitalize text-center"},Qt={class:"grid grid-cols-7 gap-px bg-gray-200 border border-gray-200 rounded-lg overflow-hidden"},Xt={key:0,class:"w-full text-center"},Zt={key:0,class:"mt-1"},te={class:"text-lg font-bold text-gray-900"},ee={key:1,class:"mt-1"},se={key:2,class:"mt-2"},oe={class:"bg-white"},ae={class:"text-lg font-bold text-gray-900 mb-4 capitalize text-center"},ne={class:"grid grid-cols-7 gap-px bg-gray-200 border border-gray-200 rounded-lg overflow-hidden"},re={key:0,class:"w-full text-center"},ie={key:0,class:"mt-1"},le={class:"text-lg font-bold text-gray-900"},de={key:1,class:"mt-1"},ce={key:2,class:"mt-2"},ue={key:0,class:"absolute inset-0 bg-white/50 z-50 flex items-center justify-center rounded-lg"},me={class:"bg-white p-3 rounded shadow border flex items-center space-x-3"},he={class:"text-sm font-medium"},fe={__name:"AttendanceCalendar",props:{employeeId:{type:String,default:null}},setup(F){p.locale("es");const E=F,b=H(!1),r=H({}),_=H(p().startOf("month")),w=R(()=>_.value.add(1,"month")),k=["Lun","Mar","Mi\xE9","Jue","Vie","S\xE1b","Dom"],x=R(()=>j(_.value)),$=R(()=>j(w.value)),Y=m=>m.format("MMMM YYYY"),L=m=>m?m.split(",").map(h=>h.trim()):[],B=m=>{const h=p(m).day();return h!==0&&h!==6};function j(m){const h=m.startOf("month"),o=m.endOf("month"),S=m.daysInMonth(),M=[];let i=h.day();i===0&&(i=7),i-=1;for(let e=0;e<i;e++)M.push({inMonth:!1,dayNum:"",date:null});for(let e=1;e<=S;e++){const n=h.date(e).format("YYYY-MM-DD");M.push({inMonth:!0,dayNum:e,date:n,isToday:n===p().format("YYYY-MM-DD"),data:r.value[n]||null})}const a=o.day();let t=0;a!==0&&(t=7-a);for(let e=0;e<t;e++)M.push({inMonth:!1,dayNum:"",date:null});return M}const T=m=>{_.value=_.value.add(m,"month"),v()},C=()=>{_.value=p().startOf("month"),v()},v=()=>G(this,null,function*(){if(!E.employeeId){r.value={};return}b.value=!0;try{const m=_.value.format("YYYY-MM-DD"),h=w.value.endOf("month").format("YYYY-MM-DD"),o=yield ct("portal_rrhh.api.attendance.get_attendance_report",{employee:E.employeeId,from_date:m,to_date:h});if(o&&o.success&&o.data){const S={};o.data.forEach(M=>{S[M.date]=M}),r.value=S}else r.value={}}catch(m){console.error(m)}finally{b.value=!1}});Q(()=>E.employeeId,()=>{v()},{immediate:!0});const N=m=>m;return(m,h)=>(u(),f("div",Ut,[s("div",Wt,[s("div",Jt,[s("button",{onClick:h[0]||(h[0]=o=>T(-1)),class:"p-2 hover:bg-gray-50 border-r border-gray-300 text-gray-600"},[z(y(X),{name:"chevron-left",class:"h-5 w-5"})]),s("button",{onClick:C,class:"px-4 py-2 text-sm font-medium hover:bg-gray-50 text-gray-700 border-r border-gray-300"},c(N("Hoy")),1),s("button",{onClick:h[1]||(h[1]=o=>T(1)),class:"p-2 hover:bg-gray-50 text-gray-600"},[z(y(X),{name:"chevron-right",class:"h-5 w-5"})])])]),s("div",qt,[s("div",Gt,[s("h3",Kt,c(Y(_.value)),1),s("div",Qt,[(u(),f(A,null,U(k,o=>s("div",{key:o,class:"bg-gray-50 py-2 text-center text-xs font-semibold text-gray-500 uppercase"},c(o),1)),64)),(u(!0),f(A,null,U(x.value,(o,S)=>(u(),f("div",{key:S,class:J(["bg-white min-h-[100px] p-2 flex flex-col items-center justify-start relative group transition-colors hover:bg-blue-50",{"bg-gray-50":!o.inMonth,"bg-blue-50":o.isToday}])},[s("span",{class:J(["text-xs font-medium mb-1",o.isToday?"text-blue-600":"text-gray-400"])},c(o.dayNum),3),o.inMonth&&o.data?(u(),f("div",Xt,[o.data.hours>0?(u(),f("div",Zt,[s("span",te,c(o.data.hours)+"h",1)])):D("",!0),o.data.status?(u(),f("div",ee,[(u(!0),f(A,null,U(L(o.data.status),(M,i)=>(u(),et(y(st),{key:i,size:"sm",variant:"subtle",theme:"orange",class:"mb-0.5 mx-auto block max-w-full truncate"},{default:P(()=>[V(c(M),1)]),_:2},1024))),128))])):D("",!0),o.data.hours===0&&!o.data.status&&B(o.date)?(u(),f("div",se,[...h[2]||(h[2]=[s("span",{class:"h-1.5 w-1.5 rounded-full bg-red-400 inline-block"},null,-1)])])):D("",!0)])):D("",!0)],2))),128))])]),s("div",oe,[s("h3",ae,c(Y(w.value)),1),s("div",ne,[(u(),f(A,null,U(k,o=>s("div",{key:o,class:"bg-gray-50 py-2 text-center text-xs font-semibold text-gray-500 uppercase"},c(o),1)),64)),(u(!0),f(A,null,U($.value,(o,S)=>(u(),f("div",{key:S,class:J(["bg-white min-h-[100px] p-2 flex flex-col items-center justify-start relative group transition-colors hover:bg-blue-50",{"bg-gray-50":!o.inMonth,"bg-blue-50":o.isToday}])},[s("span",{class:J(["text-xs font-medium mb-1",o.isToday?"text-blue-600":"text-gray-400"])},c(o.dayNum),3),o.inMonth&&o.data?(u(),f("div",re,[o.data.hours>0?(u(),f("div",ie,[s("span",le,c(o.data.hours)+"h",1)])):D("",!0),o.data.status?(u(),f("div",de,[(u(!0),f(A,null,U(L(o.data.status),(M,i)=>(u(),et(y(st),{key:i,size:"sm",variant:"subtle",theme:"orange",class:"mb-0.5 mx-auto block max-w-full truncate"},{default:P(()=>[V(c(M),1)]),_:2},1024))),128))])):D("",!0),o.data.hours===0&&!o.data.status&&B(o.date)?(u(),f("div",ce,[...h[3]||(h[3]=[s("span",{class:"h-1.5 w-1.5 rounded-full bg-red-400 inline-block"},null,-1)])])):D("",!0)])):D("",!0)],2))),128))])]),b.value?(u(),f("div",ue,[s("div",me,[h[4]||(h[4]=s("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"},null,-1)),s("span",he,c(N("Cargando...")),1)])])):D("",!0)])]))}},ge={class:"flex flex-col h-full overflow-hidden"},ve={class:"flex-1 overflow-y-auto p-5"},pe={key:0},_e={class:"text-lg font-semibold text-gray-800 mb-4"},$e={__name:"Fichaje",setup(F){const E=r=>r,b=K({url:"hrms.api.get_current_employee_info",auto:!0});return(r,_)=>(u(),f("div",ge,[s("div",ve,[z(At),y(b).data?(u(),f("div",pe,[s("h3",_e,c(E("Mi Asistencia")),1),z(fe,{employeeId:y(b).data.name},null,8,["employeeId"])])):D("",!0)])]))}};export{$e as default};
