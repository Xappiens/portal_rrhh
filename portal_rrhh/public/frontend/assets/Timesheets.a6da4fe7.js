var ge=Object.defineProperty,be=Object.defineProperties;var ye=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var xe=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var le=(p,u,d)=>u in p?ge(p,u,{enumerable:!0,configurable:!0,writable:!0,value:d}):p[u]=d,oe=(p,u)=>{for(var d in u||(u={}))xe.call(u,d)&&le(p,d,u[d]);if(se)for(var d of se(u))ke.call(u,d)&&le(p,d,u[d]);return p},ne=(p,u)=>be(p,ye(u));var Y=(p,u,d)=>new Promise((N,D)=>{var M=f=>{try{S(d.next(f))}catch(y){D(y)}},T=f=>{try{S(d.throw(f))}catch(y){D(y)}},S=f=>f.done?N(f.value):Promise.resolve(f.value).then(M,T);S((d=d.apply(p,u)).next())});import{r as v,q as L,X as we,o as c,c as m,b as s,t as l,s as A,w as h,u as i,Q as g,f as B,F as O,E as z,d as _,C as re,J as Ve,a1 as w,e as b,$ as De,a0 as Ce,a4 as F,R as Ye}from"./vendor.b007e8f2.js";import{d as V}from"./es.57c2289d.js";const Me={class:"flex flex-col h-full overflow-hidden"},Se={class:"flex-1 overflow-y-auto p-5"},Ee={class:"mb-6 flex items-center justify-between"},Ue={class:"text-2xl font-bold text-gray-900"},Be={class:"flex space-x-2"},Te={key:0,class:"bg-white rounded shadow p-4"},Ne={key:0,class:"text-center py-4"},je={key:1,class:"text-center py-4 text-gray-500"},Re={key:2,class:"w-full text-left border-collapse"},$e={class:"border-b"},Ae={class:"p-2"},He={class:"p-2"},Le={class:"p-2"},qe={class:"p-2"},Oe={class:"p-2"},ze={class:"p-2"},Fe={class:"p-2"},Ge={class:"p-2"},Pe={key:3,class:"mt-4 text-center"},Ie={key:1,class:"bg-white rounded shadow p-4"},Je={class:"mb-4 flex items-center justify-between bg-gray-50 p-3 rounded"},We={class:"flex items-center space-x-4"},Qe={class:"text-lg font-medium"},Xe={class:"mb-4"},Ke={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},Ze={class:"bg-blue-50 p-3 rounded border border-blue-100"},ea={class:"block text-xs uppercase text-blue-500 font-bold tracking-wider"},aa={class:"text-2xl font-bold text-blue-700"},ta={class:"text-lg font-semibold mb-2"},sa={class:"space-y-4"},la={class:"grid grid-cols-12 gap-2 text-sm font-medium text-gray-500 border-b pb-2"},oa={class:"col-span-2"},na={class:"col-span-3"},ra={class:"col-span-2"},da={class:"col-span-3"},ia={class:"col-span-1"},ua={class:"col-span-1 text-right"},ca={class:"col-span-2"},va=["onUpdate:modelValue","disabled"],ma=["value"],_a={class:"col-span-3"},ha={class:"col-span-2"},pa=["onClickCapture"],fa={class:"col-span-1"},ga={class:"col-span-1 text-right pt-1"},ba={key:0,class:"pt-2"},ya={class:"mt-8 flex justify-end space-x-3 pt-4 border-t"},xa={class:"mt-2"},G=20,Da={__name:"Timesheets",setup(p){V.locale("es");const u=v("list"),d=v(!1),N=v(!1),D=v(!1),M=v([]),T=v(!0),S=v(0),f=v([]),y=v([]),j=v([]),E=v({}),U=v({}),x=v(V().startOf("week").format("YYYY-MM-DD")),k=v([]),R=v(!1),$=v(!1),P=v(""),q=L(()=>V(x.value).endOf("week").format("YYYY-MM-DD")),de=L(()=>{const t=[];let a=V(x.value);for(let e=0;e<7;e++)t.push({date:a.add(e,"day").format("YYYY-MM-DD"),label:a.add(e,"day").format("dddd")});return t}),I=L(()=>k.value.reduce((t,a)=>t+(parseFloat(a.hours)||0),0)),C=L(()=>U.value.docstatus===1),J=(t=!0)=>Y(this,null,function*(){t?(d.value=!0,S.value=0,M.value=[],T.value=!0):N.value=!0;try{const a=yield w("portal_rrhh.api.timesheets.get_timesheets",{start:S.value,page_length:G});a&&a.length>0?(M.value=t?a:[...M.value,...a],S.value+=G,a.length<G&&(T.value=!1)):T.value=!1}catch(a){console.error(a)}finally{d.value=!1,N.value=!1}}),ie=()=>{J(!1)},ue=()=>Y(this,null,function*(){try{const[t,a,e,n]=yield Promise.all([w("portal_rrhh.api.timesheets.get_sedes"),w("portal_rrhh.api.timesheets.get_courses"),w("portal_rrhh.api.timesheets.get_programs"),w("portal_rrhh.api.timesheets.get_user_settings")]);f.value=t||[],y.value=a||[],j.value=e||[],E.value=n||{}}catch(t){console.error(t)}}),W=(t,a)=>{let e;return(...n)=>{clearTimeout(e),e=setTimeout(()=>t(...n),a)}},Q=W((t,a)=>Y(this,null,function*(){if(!t&&!a)return;const e=typeof a=="object"&&a!==null?a.value:a;try{const n=yield w("portal_rrhh.api.timesheets.get_courses",{txt:t,program:e});y.value=n||[]}catch(n){console.error(n)}}),300),ce=W(t=>Y(this,null,function*(){if(!!t)try{const a=yield w("portal_rrhh.api.timesheets.get_programs",{txt:t});j.value=a||[]}catch(a){console.error(a)}}),300),H=t=>V(t).format("DD/MM/YYYY"),ve=t=>V(t).format("DD/MM"),X=t=>t==="Submitted"||t==="Aprobado"?"green":t==="Draft"||t==="Borrador"?"gray":t==="Rejected"||t==="Rechazado"?"red":"blue",me=()=>{U.value={status:"Borrador"},x.value=V().startOf("week").format("YYYY-MM-DD"),k.value=[],k.value.push({date:x.value,hours:0,sede:E.value.default_sede?{label:E.value.default_sede_name,value:E.value.default_sede}:null,course:null,expediente:null}),R.value=!0,u.value="edit"},K=t=>Y(this,null,function*(){d.value=!0;try{const a=yield w("portal_rrhh.api.timesheets.get_timesheet_details",{name:t});U.value=a,x.value=a.start_date,k.value=(a.custom_sede_time_logs||[]).map(e=>({date:e.date,hours:e.hours,sede:e.sede&&f.value.find(n=>n.name===e.sede)?{label:f.value.find(n=>n.name===e.sede).room_name,value:e.sede}:e.sede,course:y.value.find(n=>n.name===e.course)?{label:y.value.find(n=>n.name===e.course).custom_display_identifier||y.value.find(n=>n.name===e.course).course_name,value:e.course}:e.course,expediente:j.value.find(n=>n.name===e.expediente)?{label:j.value.find(n=>n.name===e.expediente).custom_num_de_expediente,value:e.expediente}:e.expediente})),R.value=!1,u.value="edit"}catch(a){console.error(a)}finally{d.value=!1}}),Z=t=>{x.value=V(x.value).add(t,"week").format("YYYY-MM-DD")},_e=()=>{const t=k.value[k.value.length-1],a=t?t.date:x.value;k.value.push({date:a,hours:0,sede:E.value.default_sede?{label:E.value.default_sede_name,value:E.value.default_sede}:null,course:null,expediente:null})},he=t=>{k.value.splice(t,1)},ee=(t=!1)=>Y(this,null,function*(){D.value=!0;try{const a={name:U.value.name,start_date:x.value,end_date:q.value,logs:k.value.map(n=>{var o,ae,te;return ne(oe({},n),{sede:((o=n.sede)==null?void 0:o.value)||n.sede,course:((ae=n.course)==null?void 0:ae.value)||n.course,expediente:((te=n.expediente)==null?void 0:te.value)||n.expediente})})},e=yield w("portal_rrhh.api.timesheets.save_timesheet",{data:JSON.stringify(a)});return U.value=e,R.value=!1,e}catch(a){console.error(a)}finally{D.value=!1}}),pe=()=>Y(this,null,function*(){const t=V(),a=V(q.value);let e=[];t.isBefore(a)&&I.value<40&&e.push("La semana a\xFAn no ha terminado y/o parece que no has completado una jornada completa."),P.value=e.length>0?e.join(`
`)+`
`+r("Recuerda: El timesheet debe validarse al final de la semana o con todas las horas registradas."):r("Vas a cerrar y validar este registro de horas."),$.value=!0}),fe=()=>Y(this,null,function*(){$.value=!1,D.value=!0;try{const t=yield ee(!0);t&&(yield w("portal_rrhh.api.timesheets.submit_timesheet",{name:t.name}),yield K(t.name))}catch(t){console.error(t)}finally{D.value=!1}}),r=t=>t;return we(()=>{J(),ue()}),(t,a)=>(c(),m("div",Me,[s("div",Se,[s("div",Ee,[s("h1",Ue,l(r("Registro de Horas")),1),s("div",Be,[u.value==="edit"?(c(),A(i(g),{key:0,variant:"outline",onClick:a[0]||(a[0]=e=>u.value="list")},{default:h(()=>[b(l(r("Volver al listado")),1)]),_:1})):B("",!0),u.value==="list"?(c(),A(i(g),{key:1,variant:"solid",theme:"gray",size:"md",label:"Nuevo Registro Semanal",loading:d.value,onClick:me,class:"!bg-gray-900 !text-white hover:!bg-gray-800"},{default:h(()=>[b(l(r("Nuevo Registro Semanal")),1)]),_:1},8,["loading"])):B("",!0)])]),u.value==="list"?(c(),m("div",Te,[d.value?(c(),m("div",Ne,l(r("Cargando...")),1)):M.value.length===0?(c(),m("div",je,l(r("No hay registros de horas. Crea uno nuevo.")),1)):(c(),m("table",Re,[s("thead",null,[s("tr",$e,[s("th",Ae,l(r("Semana")),1),s("th",He,l(r("Horas Totales")),1),s("th",Le,l(r("Estado")),1),s("th",qe,l(r("Acciones")),1)])]),s("tbody",null,[(c(!0),m(O,null,z(M.value,e=>(c(),m("tr",{key:e.name,class:"border-b hover:bg-gray-50"},[s("td",Oe,l(H(e.start_date))+" - "+l(H(e.end_date)),1),s("td",ze,l(e.total_hours)+" h",1),s("td",Fe,[_(i(re),{variant:X(e.status)},{default:h(()=>[b(l(e.status),1)]),_:2},1032,["variant"])]),s("td",Ge,[_(i(g),{size:"sm",variant:"ghost",onClick:n=>K(e.name)},{default:h(()=>[b(l(r("Ver / Editar")),1)]),_:1},8,["onClick"])])]))),128))])])),T.value?(c(),m("div",Pe,[_(i(g),{variant:"subtle",loading:N.value,onClick:ie},{default:h(()=>[b(l(r("Cargar anteriores")),1)]),_:1},8,["loading"])])):B("",!0)])):(c(),m("div",Ie,[s("div",Je,[s("div",We,[_(i(g),{icon:"chevron-left",variant:"ghost",onClick:a[1]||(a[1]=e=>Z(-1)),disabled:!R.value},null,8,["disabled"]),s("div",Qe,l(r("Semana del"))+" "+l(H(x.value))+" "+l(r("al"))+" "+l(H(q.value)),1),_(i(g),{icon:"chevron-right",variant:"ghost",onClick:a[2]||(a[2]=e=>Z(1)),disabled:!R.value},null,8,["disabled"])]),s("div",null,[_(i(re),{size:"lg",variant:X(U.value.status)},{default:h(()=>[b(l(U.value.status||"Borrador"),1)]),_:1},8,["variant"])])]),s("div",Xe,[s("div",Ke,[s("div",Ze,[s("span",ea,l(r("Total Horas")),1),s("span",aa,l(I.value)+" h",1)])])]),s("h3",ta,l(r("Detalle de Actividad")),1),s("div",sa,[s("div",la,[s("div",oa,l(r("Fecha")),1),s("div",na,l(r("Sede")),1),s("div",ra,l(r("Expediente")),1),s("div",da,l(r("Curso")),1),s("div",ia,l(r("Horas")),1),s("div",ua,l(r("Acciones")),1)]),(c(!0),m(O,null,z(k.value,(e,n)=>(c(),m("div",{key:n,class:"grid grid-cols-12 gap-2 items-start border-b py-2"},[s("div",ca,[De(s("select",{"onUpdate:modelValue":o=>e.date=o,class:"form-select w-full text-sm border-gray-300 rounded focus:ring-blue-500 py-1.5",disabled:C.value},[(c(!0),m(O,null,z(de.value.map(o=>({label:o.label+" ("+ve(o.date)+")",value:o.date})),o=>(c(),m("option",{key:o.value,value:o.value},l(o.label),9,ma))),128))],8,va),[[Ce,e.date]])]),s("div",_a,[_(i(F),{modelValue:e.sede,"onUpdate:modelValue":o=>e.sede=o,options:f.value.map(o=>({label:o.room_name,value:o.name})),disabled:C.value,placeholder:"Seleccionar Sede"},null,8,["modelValue","onUpdate:modelValue","options","disabled"])]),s("div",ha,[_(i(F),{modelValue:e.expediente,"onUpdate:modelValue":[o=>e.expediente=o,()=>{e.course=null}],options:j.value.map(o=>({label:o.custom_num_de_expediente,value:o.name})),disabled:C.value,placeholder:"Buscar Exp...","onUpdate:query":a[3]||(a[3]=o=>i(ce)(o))},null,8,["modelValue","onUpdate:modelValue","options","disabled"])]),s("div",{class:"col-span-3",onClickCapture:o=>i(Q)("",e.expediente)},[_(i(F),{modelValue:e.course,"onUpdate:modelValue":o=>e.course=o,options:y.value.map(o=>({label:o.custom_display_identifier||o.course_name,value:o.name})),disabled:C.value||!e.expediente,placeholder:"Buscar Curso...","onUpdate:query":o=>i(Q)(o,e.expediente)},null,8,["modelValue","onUpdate:modelValue","options","disabled","onUpdate:query"])],40,pa),s("div",fa,[_(i(Ye),{type:"number",modelValue:e.hours,"onUpdate:modelValue":o=>e.hours=o,modelModifiers:{number:!0},disabled:C.value,min:"0",step:"0.5"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),s("div",ga,[C.value?B("",!0):(c(),A(i(g),{key:0,icon:"trash-2",variant:"ghost",class:"text-red-500 hover:text-red-700",onClick:o=>he(n)},null,8,["onClick"]))])]))),128)),C.value?B("",!0):(c(),m("div",ba,[_(i(g),{variant:"outline",icon:"plus",class:"w-full",onClick:_e},{default:h(()=>[b(l(r("A\xF1adir Registro")),1)]),_:1})]))]),s("div",ya,[C.value?B("",!0):(c(),A(i(g),{key:0,variant:"subtle",onClick:a[4]||(a[4]=e=>ee(!1)),loading:D.value},{default:h(()=>[b(l(r("Guardar Borrador")),1)]),_:1},8,["loading"])),C.value?B("",!0):(c(),A(i(g),{key:1,variant:"solid",onClick:pe,loading:D.value},{default:h(()=>[b(l(r("Validar y Enviar")),1)]),_:1},8,["loading"]))])]))]),_(i(Ve),{modelValue:$.value,"onUpdate:modelValue":a[6]||(a[6]=e=>$.value=e),title:r("Advertencia de Env\xEDo")},{"body-content":h(()=>[s("p",null,l(P.value),1),s("p",xa,l(r("\xBFEst\xE1s seguro de que quieres validar este registro ahora? Ya no podr\xE1s editarlo despu\xE9s.")),1)]),actions:h(()=>[_(i(g),{variant:"outline",onClick:a[5]||(a[5]=e=>$.value=!1)},{default:h(()=>[b(l(r("Cancelar")),1)]),_:1}),_(i(g),{variant:"solid",theme:"red",onClick:fe},{default:h(()=>[b(l(r("S\xED, Validar")),1)]),_:1})]),_:1},8,["modelValue","title"])]))}};export{Da as default};
