var B=(j,b,c)=>new Promise((n,u)=>{var k=r=>{try{_(c.next(r))}catch(x){u(x)}},E=r=>{try{_(c.throw(r))}catch(x){u(x)}},_=r=>r.done?n(r.value):Promise.resolve(r.value).then(k,E);_((c=c.apply(j,b)).next())});import{r as p,q as T,a8 as W,o as i,c as d,b as t,t as a,d as h,u as m,a5 as F,a4 as q,W as Q,Z as R,f,w as C,Q as P,n as w,C as G,s as Z,F as N,E as S,_ as $,aa as K,e as A}from"./vendor.0086aa74.js";import{d as D}from"./es.72676fb6.js";const X={class:"flex flex-col h-full overflow-hidden bg-white"},ee={class:"flex-1 overflow-y-auto p-5"},te={class:"mb-6 flex items-center justify-between"},se={class:"text-2xl font-bold text-gray-900"},oe={class:"bg-gray-50 rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},ae={class:"grid grid-cols-12 gap-4 items-end"},le={class:"col-span-6 md:col-span-3"},ne={class:"block text-sm font-medium text-gray-700 mb-1"},re={class:"col-span-6 md:col-span-3"},ie={class:"block text-sm font-medium text-gray-700 mb-1"},de={class:"col-span-6 md:col-span-3"},ce={class:"block text-sm font-medium text-gray-700 mb-1"},ue={key:0,class:"col-span-6 md:col-span-1 flex items-end pb-1"},me={class:"flex items-center gap-2 cursor-pointer"},ge={class:"col-span-12 md:col-span-2"},pe={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},he={class:"text-xs text-gray-500 font-medium uppercase"},fe={class:"text-3xl font-bold text-gray-900 mt-2"},_e={key:0,class:"text-xs text-gray-400 mt-1"},ve={class:"text-xs text-gray-500 font-medium uppercase"},ye={class:"text-3xl font-bold text-gray-900 mt-2"},be={key:0,class:"text-xs text-gray-400 mt-1"},xe={class:"text-xs text-gray-500 font-medium uppercase"},we={class:"text-3xl font-bold text-gray-900 mt-2"},ke={key:0,class:"text-xs text-gray-400 mt-1"},Ee={class:"text-xs text-gray-500 font-medium uppercase"},Me={class:"text-3xl font-bold text-gray-900 mt-2"},Ce={key:0,class:"text-xs text-gray-400 mt-1"},Ae={key:0,class:"mb-4 flex items-center gap-2"},De={class:"text-lg font-semibold text-gray-800"},Ye={key:1,class:"bg-white rounded-lg border border-gray-200 shadow-sm"},je={class:"overflow-hidden"},Ve=["onClick"],Be={class:"flex items-center gap-3"},Te={class:"h-8 w-8 rounded-full bg-gray-100 flex items-center justify-center text-xs font-bold text-gray-600"},Fe={class:"text-sm font-semibold text-gray-900"},Pe={class:"text-xs text-gray-500"},Ge={key:0,class:"bg-gray-50/50 p-4 border-t border-gray-100 pl-14"},Ne={class:"w-full"},Se={class:"text-left text-xs text-gray-500 uppercase"},$e={class:"pb-2 font-medium"},Ie={class:"pb-2 font-medium"},Ue={class:"pb-2 font-medium"},ze={class:"divide-y divide-gray-100"},Je={class:"py-2 text-sm text-gray-900 font-medium w-32 whitespace-nowrap"},Le={class:"py-2 w-48"},Oe={class:"py-2 text-sm text-gray-600"},He={key:2,class:"text-center py-12 bg-white rounded-lg border border-dashed border-gray-300"},We={class:"text-gray-400 mb-2"},qe={class:"text-gray-500 font-medium"},Qe={key:3,class:"text-center py-20"},Re={class:"text-lg font-medium text-gray-900 mb-2"},Ze={class:"text-gray-500 max-w-sm mx-auto"},tt={__name:"AttendanceAnomalies",setup(j){D.locale("es");const b=p(!1),c=p([]),n=p(null),u=p([]),k=p([]),E=p(!1),_=p(null),r=p({from_date:D().subtract(30,"days").format("YYYY-MM-DD"),to_date:D().format("YYYY-MM-DD"),reports_to:"",show_all:!1});function x(e){e&&e.value?(_.value=e,r.value.reports_to=e.value):(_.value=null,r.value.reports_to="")}const g=T(()=>{const e={total:0,ghost:0,missing:0,time:0,absent:0};for(const o of c.value)e.total++,o.type==="Ghost Employee"?e.ghost++:o.type==="Missing Punch"?e.missing++:o.type==="Excessive Continuous Work"||o.type==="No Break"?e.time++:o.type==="Absent"&&e.absent++;return e}),Y=T(()=>{if(!n.value)return[];let e=[];n.value==="Ghost Employee"?e=c.value.filter(s=>s.type==="Ghost Employee"):n.value==="Missing Punch"?e=c.value.filter(s=>s.type==="Missing Punch"):n.value==="Time Issue"?e=c.value.filter(s=>["Excessive Continuous Work","No Break"].includes(s.type)):n.value==="Absent"&&(e=c.value.filter(s=>s.type==="Absent"));const o={};return e.forEach(s=>{o[s.employee]||(o[s.employee]=[]),o[s.employee].push(s)}),Object.keys(o).map(s=>({employee:s,items:o[s].sort((v,y)=>new Date(y.date)-new Date(v.date))})).sort((s,v)=>v.items.length!==s.items.length?v.items.length-s.items.length:s.employee.localeCompare(v.employee))}),V=()=>B(this,null,function*(){b.value=!0;try{const e=yield K("portal_rrhh.api.attendance.get_attendance_anomalies",{from_date:r.value.from_date,to_date:r.value.to_date,reports_to:r.value.reports_to||null,show_all:r.value.show_all?1:0});e&&e.success?(c.value=e.data||[],k.value=e.managers||[],E.value=e.is_hr_user||!1):(c.value=[],console.error("Error fetching anomalies:",e==null?void 0:e.message))}catch(e){console.error("Error fetching anomalies:",e),c.value=[]}finally{b.value=!1,u.value=[]}}),M=e=>{n.value===e?n.value=null:n.value=e,u.value=[]},I=e=>{u.value.includes(e)?u.value=u.value.filter(o=>o!==e):u.value.push(e)},U=e=>e?e.split(" ").map(o=>o[0]).join("").substring(0,2).toUpperCase():"?",z=e=>e==="Ghost Employee"?l("Sin Fichajes (Job Offer)"):e==="Missing Punch"?l("Fichajes Faltantes"):e==="Time Issue"?l("Jornada > 6h sin descanso"):e==="Absent"?l("Ausencias"):e,J=e=>e==="Ghost Employee"?"purple":e==="Missing Punch"?"orange":e==="Time Issue"?"blue":e==="Absent"?"red":"gray",L=e=>D(e).format("DD MMM (ddd)"),l=e=>e,O=e=>e==="Missing Punch"?"orange":e==="Absent"||e==="Ghost Employee"?"red":["Late Entry","Early Exit","No Break"].includes(e)||e.includes("Excessive")?"yellow":"gray";return W(()=>{V()}),(e,o)=>(i(),d("div",X,[t("div",ee,[t("div",te,[t("h1",se,a(l("Anomal\xEDas de Asistencia")),1)]),t("div",oe,[t("div",ae,[t("div",le,[t("label",ne,a(l("Desde")),1),h(m(F),{modelValue:r.value.from_date,"onUpdate:modelValue":o[0]||(o[0]=s=>r.value.from_date=s),class:"w-full","format-options":{day:"2-digit",month:"2-digit",year:"numeric"},"input-format":"DD/MM/YYYY","first-day-of-week":1,locale:"es"},null,8,["modelValue"])]),t("div",re,[t("label",ie,a(l("Hasta")),1),h(m(F),{modelValue:r.value.to_date,"onUpdate:modelValue":o[1]||(o[1]=s=>r.value.to_date=s),class:"w-full","format-options":{day:"2-digit",month:"2-digit",year:"numeric"},"input-format":"DD/MM/YYYY","first-day-of-week":1,locale:"es"},null,8,["modelValue"])]),t("div",de,[t("label",ce,a(l("Responsable")),1),h(m(q),{modelValue:_.value,options:k.value,placeholder:"Todos...","onUpdate:modelValue":x},null,8,["modelValue","options"])]),E.value?(i(),d("div",ue,[t("label",me,[Q(t("input",{type:"checkbox","onUpdate:modelValue":o[2]||(o[2]=s=>r.value.show_all=s),class:"w-4 h-4 text-gray-900 border-gray-300 rounded focus:ring-gray-500"},null,512),[[R,r.value.show_all]]),o[8]||(o[8]=t("span",{class:"text-xs font-medium text-gray-600 whitespace-nowrap"},"Ver todos",-1))])])):f("",!0),t("div",ge,[h(m(P),{variant:"solid",theme:"gray",class:"w-full justify-center !bg-black !text-white hover:!bg-gray-800",loading:b.value,onClick:V},{default:C(()=>[A(a(l("Actualizar")),1)]),_:1},8,["loading"])])])]),t("div",pe,[t("div",{class:w(["cursor-pointer p-4 rounded-lg border shadow-sm transition-all duration-200 flex flex-col",n.value==="Ghost Employee"?"bg-purple-50 border-purple-200 ring-2 ring-purple-100":"bg-white border-gray-200 hover:border-purple-200"]),onClick:o[3]||(o[3]=s=>M("Ghost Employee"))},[t("span",he,a(l("Sin Fichajes (Job Offer)")),1),t("span",fe,a(g.value.ghost),1),g.value.ghost>0?(i(),d("span",_e,a(l("Empleados sin actividad")),1)):f("",!0)],2),t("div",{class:w(["cursor-pointer p-4 rounded-lg border shadow-sm transition-all duration-200 flex flex-col",n.value==="Missing Punch"?"bg-orange-50 border-orange-200 ring-2 ring-orange-100":"bg-white border-gray-200 hover:border-orange-200"]),onClick:o[4]||(o[4]=s=>M("Missing Punch"))},[t("span",ve,a(l("Fichajes Faltantes")),1),t("span",ye,a(g.value.missing),1),g.value.missing>0?(i(),d("span",be,a(l("Entradas sin Salida (o viceversa)")),1)):f("",!0)],2),t("div",{class:w(["cursor-pointer p-4 rounded-lg border shadow-sm transition-all duration-200 flex flex-col",n.value==="Time Issue"?"bg-blue-50 border-blue-200 ring-2 ring-blue-100":"bg-white border-gray-200 hover:border-blue-200"]),onClick:o[5]||(o[5]=s=>M("Time Issue"))},[t("span",xe,a(l("Jornada > 6h sin descanso")),1),t("span",we,a(g.value.time),1),g.value.time>0?(i(),d("span",ke,a(l("Sesiones largas o sin pausa")),1)):f("",!0)],2),t("div",{class:w(["cursor-pointer p-4 rounded-lg border shadow-sm transition-all duration-200 flex flex-col",n.value==="Absent"?"bg-red-50 border-red-200 ring-2 ring-red-100":"bg-white border-gray-200 hover:border-red-200"]),onClick:o[6]||(o[6]=s=>M("Absent"))},[t("span",Ee,a(l("Ausencias")),1),t("span",Me,a(g.value.absent),1),g.value.absent>0?(i(),d("span",Ce,a(l("Sin justificar")),1)):f("",!0)],2)]),n.value?(i(),d("div",Ae,[t("h2",De,a(z(n.value)),1),h(m(G),{theme:J(n.value),size:"lg"},{default:C(()=>[A(a(Y.value.length)+" "+a(l("Empleados")),1)]),_:1},8,["theme"]),n.value?(i(),Z(m(P),{key:0,variant:"ghost",class:"ml-auto",onClick:o[7]||(o[7]=s=>n.value=null)},{default:C(()=>[A(a(l("Cerrar")),1)]),_:1})):f("",!0)])):f("",!0),n.value&&Y.value.length>0?(i(),d("div",Ye,[t("div",je,[(i(!0),d(N,null,S(Y.value,(s,v)=>(i(),d("div",{key:v,class:"border-b last:border-b-0 border-gray-100"},[t("div",{class:"p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50 transition-colors",onClick:y=>I(s.employee)},[t("div",Be,[t("div",Te,a(U(s.employee)),1),t("div",null,[t("div",Fe,a(s.employee),1),t("div",Pe,a(s.items.length)+" "+a(s.items.length===1?l("anomal\xEDa"):l("anomal\xEDas")),1)])]),t("div",{class:w(["transform transition-transform duration-200",{"rotate-180":u.value.includes(s.employee)}])},[h(m($),{name:"chevron-down",class:"w-4 h-4 text-gray-400"})],2)],8,Ve),u.value.includes(s.employee)?(i(),d("div",Ge,[t("table",Ne,[t("thead",null,[t("tr",Se,[t("th",$e,a(l("Fecha")),1),t("th",Ie,a(l("Tipo")),1),t("th",Ue,a(l("Detalle")),1)])]),t("tbody",ze,[(i(!0),d(N,null,S(s.items,(y,H)=>(i(),d("tr",{key:H},[t("td",Je,a(L(y.date)),1),t("td",Le,[h(m(G),{theme:O(y.type),size:"sm"},{default:C(()=>[A(a(l(y.type)),1)]),_:2},1032,["theme"])]),t("td",Oe,a(y.description),1)]))),128))])])])):f("",!0)]))),128))])])):n.value?(i(),d("div",He,[t("div",We,[h(m($),{name:"check-circle",class:"w-8 h-8 mx-auto"})]),t("p",qe,a(l("No hay anomal\xEDas de este tipo en el per\xEDodo seleccionado.")),1)])):(i(),d("div",Qe,[t("h3",Re,a(l("Selecciona una categor\xEDa")),1),t("p",Ze,a(l("Haz clic en una de las tarjetas de arriba para ver los empleados afectados y los detalles.")),1)]))])]))}};export{tt as default};
