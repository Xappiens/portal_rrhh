var O=(j,x,h)=>new Promise((_,b)=>{var f=c=>{try{l(h.next(c))}catch(p){b(p)}},m=c=>{try{l(h.throw(c))}catch(p){b(p)}},l=c=>c.done?_(c.value):Promise.resolve(c.value).then(f,m);l((h=h.apply(j,x)).next())});import{a3 as P,r as M,q as T,K as Z,X as ee,o as a,c as n,b as t,t as i,s as V,w as z,u as y,Q as te,f as v,d as I,a4 as se,_ as G,F as k,E as Y,a2 as oe,a1 as J,e as L,n as E,C as K}from"./vendor.5466f047.js";import{d as D}from"./es.327155e1.js";var Q={exports:{}};(function(j,x){(function(h,_){j.exports=_()})(P,function(){return function(h,_,b){_.prototype.isBetween=function(f,m,l,c){var p=b(f),w=b(m),$=(c=c||"()")[0]==="(",B=c[1]===")";return($?this.isAfter(p,l):!this.isBefore(p,l))&&(B?this.isBefore(w,l):!this.isAfter(w,l))||($?this.isBefore(p,l):!this.isAfter(p,l))&&(B?this.isAfter(w,l):!this.isBefore(w,l))}}})})(Q);var ae=Q.exports;const ne={class:"flex flex-col h-full overflow-hidden bg-white"},le={class:"flex-1 overflow-y-auto p-5"},re={class:"mb-6 flex items-center justify-between"},de={class:"text-2xl font-bold text-gray-900"},ie={class:"flex items-center space-x-2"},ce={class:"bg-gray-50 rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},ue={class:"grid grid-cols-1 md:grid-cols-2 gap-4 items-end"},me={class:"flex-1"},he={class:"block text-sm font-medium text-gray-700 mb-1"},fe={class:"flex justify-end"},pe={class:"flex items-center bg-white rounded-md shadow-sm border border-gray-300"},ge={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},ve={class:"bg-white"},be={class:"text-lg font-bold text-gray-900 mb-4 capitalize text-center"},_e={class:"grid grid-cols-7 gap-px bg-gray-200 border border-gray-200 rounded-lg overflow-hidden"},ye={key:0,class:"w-full text-center"},xe={key:0,class:"mt-1"},we={class:"text-lg font-bold text-gray-900"},Me={key:1,class:"mt-1"},ke={key:2,class:"mt-2"},Ye={class:"bg-white"},De={class:"text-lg font-bold text-gray-900 mb-4 capitalize text-center"},$e={class:"grid grid-cols-7 gap-px bg-gray-200 border border-gray-200 rounded-lg overflow-hidden"},Be={key:0,class:"w-full text-center"},Ce={key:0,class:"mt-1"},je={class:"text-lg font-bold text-gray-900"},Ee={key:1,class:"mt-1"},Ne={key:2,class:"mt-2"},Ae={key:0,class:"fixed inset-0 bg-white/50 z-50 flex items-center justify-center"},Oe={class:"bg-white p-4 rounded shadow-lg flex items-center space-x-3"},Ie={__name:"AttendanceReport",setup(j){D.extend(ae),D.locale("es");const x=M(!1),h=M([]),_=M([]),b=M({}),f=M({employee:null}),m=M(D().startOf("month")),l=T(()=>m.value.add(1,"month")),c=["Lun","Mar","Mi\xE9","Jue","Vie","S\xE1b","Dom"],p=T(()=>U(m.value)),w=T(()=>U(l.value)),$=o=>o.format("MMMM YYYY"),B=o=>o?o.split(",").map(s=>s.trim()):[],R=o=>{const s=D(o).day();return s!==0&&s!==6};function U(o){const s=o.startOf("month"),e=o.endOf("month"),d=o.daysInMonth(),r=[];let u=s.day();u===0&&(u=7),u-=1;for(let g=0;g<u;g++)r.push({inMonth:!1,dayNum:"",date:null});for(let g=1;g<=d;g++){const A=s.date(g).format("YYYY-MM-DD");r.push({inMonth:!0,dayNum:g,date:A,isToday:A===D().format("YYYY-MM-DD"),data:b.value[A]||null})}42-r.length;const F=e.day();let H=0;F!==0&&(H=7-F);for(let g=0;g<H;g++)r.push({inMonth:!1,dayNum:"",date:null});return r}const S=o=>{m.value=m.value.add(o,"month"),N()},W=()=>{m.value=D().startOf("month"),N()},q=oe(o=>O(this,null,function*(){try{const s=yield J("portal_rrhh.portal_rrhh.employee_data.get_employees_list",{search_term:o});_.value=(s.employees||[]).map(e=>{const d=e.status||"Sin estado",r=e.custom_dninie||"Sin DNI",u=e.attendance_device_id?`[${e.attendance_device_id}]`:"";return{label:`${e.employee_name} (${r}) ${u} [${d}]`,value:e.name}})}catch(s){console.error("Search failed:",s)}}),300),N=()=>O(this,null,function*(){if(!!f.value.employee){x.value=!0;try{const o=m.value.format("YYYY-MM-DD"),s=l.value.endOf("month").format("YYYY-MM-DD"),e=yield J("portal_rrhh.api.attendance.get_attendance_report",{employee:f.value.employee.value,from_date:o,to_date:s});if(e&&e.success){h.value=e.data;const d={};e.data&&e.data.forEach(r=>{d[r.date]=r}),b.value=d}}catch(o){console.error(o)}finally{x.value=!1}}});Z(()=>f.value.employee,()=>{f.value.employee?N():(h.value=[],b.value={})});const X=()=>{let o="data:text/csv;charset=utf-8,";o+=`Fecha,Horas,Estado,Logs
`,h.value.forEach(d=>{const r=(d.logs||[]).map(u=>`${u.type} ${u.time}`).join(" | ");o+=`${d.date},${d.hours},"${d.status||""}","${r}"
`});const s=encodeURI(o),e=document.createElement("a");e.setAttribute("href",s),e.setAttribute("download",`Reporte_${f.value.employee.label}_${m.value.format("MM-YYYY")}.csv`),document.body.appendChild(e),e.click(),document.body.removeChild(e)},C=o=>o;return ee(()=>{q("")}),(o,s)=>(a(),n("div",ne,[t("div",le,[t("div",re,[t("h1",de,i(C("Reporte de Asistencia")),1),t("div",ie,[h.value.length>0?(a(),V(y(te),{key:0,variant:"outline",onClick:X},{default:z(()=>[L(i(C("Exportar a Excel")),1)]),_:1})):v("",!0)])]),t("div",ce,[t("div",ue,[t("div",me,[t("label",he,i(C("Empleado")),1),I(y(se),{modelValue:f.value.employee,"onUpdate:modelValue":s[0]||(s[0]=e=>f.value.employee=e),options:_.value,placeholder:"Buscar por nombre, DNI o ID...","onUpdate:query":y(q)},null,8,["modelValue","options","onUpdate:query"])]),t("div",fe,[t("div",pe,[t("button",{onClick:s[1]||(s[1]=e=>S(-1)),class:"p-2 hover:bg-gray-50 border-r border-gray-300 text-gray-600"},[I(y(G),{name:"chevron-left",class:"h-5 w-5"})]),t("button",{onClick:W,class:"px-4 py-2 text-sm font-medium hover:bg-gray-50 text-gray-700 border-r border-gray-300"},i(C("Hoy")),1),t("button",{onClick:s[2]||(s[2]=e=>S(1)),class:"p-2 hover:bg-gray-50 text-gray-600"},[I(y(G),{name:"chevron-right",class:"h-5 w-5"})])])])])]),t("div",ge,[t("div",ve,[t("h3",be,i($(m.value)),1),t("div",_e,[(a(),n(k,null,Y(c,e=>t("div",{key:e,class:"bg-gray-50 py-2 text-center text-xs font-semibold text-gray-500 uppercase"},i(e),1)),64)),(a(!0),n(k,null,Y(p.value,(e,d)=>(a(),n("div",{key:d,class:E(["bg-white min-h-[100px] p-2 flex flex-col items-center justify-start relative group transition-colors hover:bg-blue-50",{"bg-gray-50":!e.inMonth,"bg-blue-50":e.isToday}])},[t("span",{class:E(["text-xs font-medium mb-1",e.isToday?"text-blue-600":"text-gray-400"])},i(e.dayNum),3),e.inMonth&&e.data?(a(),n("div",ye,[e.data.hours>0?(a(),n("div",xe,[t("span",we,i(e.data.hours)+"h",1)])):v("",!0),e.data.status?(a(),n("div",Me,[(a(!0),n(k,null,Y(B(e.data.status),(r,u)=>(a(),V(y(K),{key:u,size:"sm",variant:"subtle",theme:"orange",class:"mb-0.5 mx-auto block max-w-full truncate"},{default:z(()=>[L(i(r),1)]),_:2},1024))),128))])):v("",!0),e.data.hours===0&&!e.data.status&&R(e.date)?(a(),n("div",ke,[...s[3]||(s[3]=[t("span",{class:"h-1.5 w-1.5 rounded-full bg-red-400 inline-block"},null,-1)])])):v("",!0)])):v("",!0)],2))),128))])]),t("div",Ye,[t("h3",De,i($(l.value)),1),t("div",$e,[(a(),n(k,null,Y(c,e=>t("div",{key:e,class:"bg-gray-50 py-2 text-center text-xs font-semibold text-gray-500 uppercase"},i(e),1)),64)),(a(!0),n(k,null,Y(w.value,(e,d)=>(a(),n("div",{key:d,class:E(["bg-white min-h-[100px] p-2 flex flex-col items-center justify-start relative group transition-colors hover:bg-blue-50",{"bg-gray-50":!e.inMonth,"bg-blue-50":e.isToday}])},[t("span",{class:E(["text-xs font-medium mb-1",e.isToday?"text-blue-600":"text-gray-400"])},i(e.dayNum),3),e.inMonth&&e.data?(a(),n("div",Be,[e.data.hours>0?(a(),n("div",Ce,[t("span",je,i(e.data.hours)+"h",1)])):v("",!0),e.data.status?(a(),n("div",Ee,[(a(!0),n(k,null,Y(B(e.data.status),(r,u)=>(a(),V(y(K),{key:u,size:"sm",variant:"subtle",theme:"orange",class:"mb-0.5 mx-auto block max-w-full truncate"},{default:z(()=>[L(i(r),1)]),_:2},1024))),128))])):v("",!0),e.data.hours===0&&!e.data.status&&R(e.date)?(a(),n("div",Ne,[...s[4]||(s[4]=[t("span",{class:"h-1.5 w-1.5 rounded-full bg-red-400 inline-block"},null,-1)])])):v("",!0)])):v("",!0)],2))),128))])])]),x.value?(a(),n("div",Ae,[t("div",Oe,[s[5]||(s[5]=t("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"},null,-1)),t("span",null,i(C("Cargando datos...")),1)])])):v("",!0)])]))}};export{Ie as default};
