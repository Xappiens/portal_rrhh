var Z=(P,A,r)=>new Promise((S,R)=>{var g=p=>{try{b(r.next(p))}catch(f){R(f)}},i=p=>{try{b(r.throw(p))}catch(f){R(f)}},b=p=>p.done?S(p.value):Promise.resolve(p.value).then(g,i);b((r=r.apply(P,A)).next())});import{q as D,r as E,l as U,K as te,o as l,s as M,w as y,b as e,d as u,u as s,_ as k,c as n,t as o,f as h,n as H,R as se,I as le,J as oe,W as Q,X as ne,Y as ie,Z as re,C as O,U as J,e as j,F as K,E as X,$ as W,Q as ae}from"./vendor.0086aa74.js";import{u as L,s as de}from"./index.67f1feb8.js";import{_ as ue}from"./Modelo145Dialog.64cd28e5.js";const ce={class:"p-5 text-base text-gray-800 max-h-[70vh] overflow-y-auto"},me={class:"space-y-5"},pe={class:"bg-red-50 border border-red-200 rounded-lg p-4"},fe={class:"flex items-start gap-2"},ve={key:0,class:"bg-gray-50 p-4 rounded-lg border border-gray-200"},ge={class:"flex items-center gap-2"},xe={class:"font-mono text-sm text-gray-900"},be={key:0,class:"mt-1 text-sm text-red-600"},ye={key:1,class:"mt-1 text-xs text-gray-500"},_e={key:1,class:"bg-blue-50 p-4 rounded-lg border border-blue-200"},he={class:"flex items-center gap-2"},we={class:"font-medium text-sm text-blue-900"},ke={key:0,class:"mt-1 text-sm text-red-600"},Ie={key:1,class:"mt-3 flex items-center gap-2 bg-gray-50 p-2 rounded"},Re={class:"text-sm text-gray-700"},Ee={class:"text-xs text-gray-500"},Se={key:0,class:"mt-1 text-sm text-red-600"},Fe={class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},$e={class:"flex items-start gap-2"},Ne={key:2},Be={__name:"IbanChangeDialog",props:{modelValue:{type:Boolean,default:!1},currentIban:{type:String,default:""},employeeId:{type:String,required:!0}},emits:["update:modelValue","success"],setup(P,{emit:A}){const r=P,S=A,R=D({get:()=>r.modelValue,set:a=>S("update:modelValue",a)}),g=E({new_iban:"",bank_entity:"",reason:"",certificate_attachment:null}),i=E(null),b=E(null),p=E(!1),f=E(null),w=E(""),_=E(""),F=E(""),q=D(()=>{var N;const a=g.value.new_iban.replace(/\s/g,"").toUpperCase(),d=a&&C(a)&&!w.value,m=!!i.value,$=!!((N=g.value.reason)==null?void 0:N.trim());return d&&m&&$&&!p.value}),G=U({url:"portal_rrhh.api.iban.create_iban_change_request",method:"POST",onSuccess(){S("success"),R.value=!1,V(),window.frappe&&window.frappe.show_alert&&window.frappe.show_alert({message:"Solicitud enviada correctamente. Puedes ver su estado en tu perfil.",indicator:"green"})},onError(a){a.messages?f.value=a.messages.join(`
`):f.value=a.message||"Error al crear la solicitud"}});function z(a){var m;if(!a)return"";const d=a.replace(/\s/g,"");return((m=d.match(/.{1,4}/g))==null?void 0:m.join(" "))||d}function C(a){if(!a)return!1;const d=a.replace(/\s/g,"").toUpperCase();if(!/^ES\d{2}\d{4}\d{4}\d{1}\d{1}\d{10}$/.test(d))return!1;const $=d.slice(4)+d.slice(0,4);let N="";for(const T of $)T>="A"&&T<="Z"?N+=String(T.charCodeAt(0)-"A".charCodeAt(0)+10):N+=T;try{return BigInt(N)%BigInt(97)===BigInt(1)}catch(T){let Y=0;for(let ee=0;ee<N.length;ee++)Y=(Y*10+parseInt(N[ee]))%97;return Y===1}}function I(a){if(!a){w.value="",g.value.bank_entity="";return}const d=a.replace(/\s/g,"").toUpperCase();if(g.value.new_iban=z(d),!C(d)){w.value="El formato del IBAN no es v\xE1lido",g.value.bank_entity="";return}w.value="";const m=d.substring(4,8),$={"0049":"Banco Santander","0128":"Bankinter","0182":"BBVA","2038":"Bankia","2100":"CaixaBank","0081":"Banco Sabadell","0030":"Banco Espa\xF1ol de Cr\xE9dito","0073":"Openbank","3058":"Cajamar","2085":"Ibercaja"};g.value.bank_entity=$[m]||`Entidad desconocida (${m})`}function t(a){const d=a.target.files[0];if(!d)return;if(_.value="",!["application/pdf","image/jpeg","image/png","image/jpg"].includes(d.type)){_.value="Solo se permiten archivos PDF, JPG, JPEG o PNG";return}if(d.size>5*1024*1024){_.value="El archivo no puede superar los 5MB";return}i.value=d}function B(){i.value=null,_.value="",b.value&&(b.value.value="")}function x(a){if(a===0)return"0 Bytes";const d=1024,m=["Bytes","KB","MB","GB"],$=Math.floor(Math.log(a)/Math.log(d));return parseFloat((a/Math.pow(d,$)).toFixed(2))+" "+m[$]}function c(){return Z(this,null,function*(){var d;if(!i.value)return null;const a=new FormData;a.append("file",i.value),a.append("doctype","IBAN Change Request"),a.append("docname","new-document"),a.append("fieldname","certificate_attachment");try{const m=yield fetch("/api/method/upload_file",{method:"POST",headers:{"X-Frappe-CSRF-Token":window.csrf_token||window.frappe&&window.frappe.csrf_token},body:a});if(!m.ok){const N=yield m.json();throw new Error(N.message||"Error al subir el archivo")}return((d=(yield m.json()).message)==null?void 0:d.file_url)||null}catch(m){throw console.error("Error uploading file:",m),m}})}function v(){return Z(this,null,function*(){var d;if(p.value)return;if(p.value=!0,f.value=null,w.value="",_.value="",F.value="",!g.value.new_iban){w.value="El nuevo IBAN es obligatorio",p.value=!1;return}const a=g.value.new_iban.replace(/\s/g,"").toUpperCase();if(!C(a)){w.value="El formato del IBAN no es v\xE1lido",p.value=!1;return}if(!i.value){_.value="El certificado bancario es obligatorio",p.value=!1;return}if(!((d=g.value.reason)==null?void 0:d.trim())){F.value="El motivo del cambio es obligatorio",p.value=!1;return}try{const m=yield c();if(!m)throw new Error("No se pudo subir el certificado");const $={data:{employee:r.employeeId,new_iban:a,reason:g.value.reason||"",certificate_attachment:m}};console.log("Enviando solicitud de cambio de IBAN:",$);const N=yield G.submit($);console.log("Respuesta del servidor:",N)}catch(m){console.error("Error al crear solicitud:",m),m.messages&&Array.isArray(m.messages)?f.value=m.messages.join(`
`):m.messages?f.value=m.messages:m.exc?f.value=m.exc:f.value=m.message||"Error al crear la solicitud"}finally{p.value=!1}})}function V(){g.value={new_iban:"",bank_entity:"",reason:"",certificate_attachment:null},i.value=null,f.value=null,w.value="",_.value="",F.value="",b.value&&(b.value.value="")}return te(R,a=>{a||V()}),(a,d)=>(l(),M(s(oe),{modelValue:R.value,"onUpdate:modelValue":d[2]||(d[2]=m=>R.value=m),options:{title:"Solicitar Cambio de IBAN",size:"2xl",actions:[{label:"Enviar Solicitud",variant:"solid",loading:p.value,disabled:!q.value,onClick:v}]}},{"body-content":y(()=>[e("div",ce,[e("div",me,[e("div",pe,[e("div",fe,[u(s(k),{name:"alert-triangle",class:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),d[3]||(d[3]=e("div",{class:"text-sm text-red-800"},[e("p",{class:"font-semibold mb-1"},"Campos obligatorios:"),e("ul",{class:"list-disc list-inside space-y-1 text-xs"},[e("li",null,"Debe introducir un IBAN v\xE1lido"),e("li",null,"Debe adjuntar el justificante bancario (certificado de titularidad)"),e("li",null,"Debe indicar el motivo del cambio")]),e("p",{class:"mt-2 text-xs font-medium"},"No podr\xE1 enviar la solicitud sin completar todos los campos obligatorios.")],-1))])]),P.currentIban?(l(),n("div",ve,[d[4]||(d[4]=e("label",{class:"block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2"}," IBAN Actual ",-1)),e("div",ge,[u(s(k),{name:"credit-card",class:"h-4 w-4 text-gray-500"}),e("span",xe,o(z(P.currentIban)),1)])])):h("",!0),e("div",null,[u(s(se),{label:"Nuevo IBAN *",modelValue:g.value.new_iban,"onUpdate:modelValue":[d[0]||(d[0]=m=>g.value.new_iban=m),I],placeholder:"ES00 0000 0000 0 0 0000000000",class:H(w.value?"border-red-500":"")},null,8,["modelValue","class"]),w.value?(l(),n("p",be,o(w.value),1)):(l(),n("p",ye," Formato: ES00 0000 0000 0 0 0000000000 "))]),g.value.bank_entity?(l(),n("div",_e,[d[5]||(d[5]=e("label",{class:"block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2"}," Entidad Bancaria Detectada ",-1)),e("div",he,[u(s(k),{name:"building",class:"h-4 w-4 text-blue-500"}),e("span",we,o(g.value.bank_entity),1)])])):h("",!0),e("div",null,[d[6]||(d[6]=e("label",{class:"block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2"}," Certificado Bancario * ",-1)),d[7]||(d[7]=e("p",{class:"text-xs text-gray-500 mb-3"}," Suba el certificado bancario (PDF, PNG, JPG - M\xE1x. 5MB) ",-1)),e("input",{type:"file",ref_key:"fileInput",ref:b,onChange:t,accept:".pdf,.png,.jpg,.jpeg",class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 transition-colors cursor-pointer"},null,544),_.value?(l(),n("p",ke,o(_.value),1)):h("",!0),i.value?(l(),n("div",Ie,[u(s(k),{name:"file",class:"h-4 w-4 text-gray-500"}),e("span",Re,o(i.value.name),1),e("span",Ee,"("+o(x(i.value.size))+")",1),e("button",{onClick:B,class:"ml-auto text-red-600 hover:text-red-700"},[u(s(k),{name:"x",class:"h-4 w-4"})])])):h("",!0)]),e("div",null,[u(s(se),{label:"Motivo del cambio *",type:"textarea",modelValue:g.value.reason,"onUpdate:modelValue":d[1]||(d[1]=m=>g.value.reason=m),rows:"3",placeholder:"Explique el motivo del cambio de IBAN...",class:H(F.value?"border-red-500":"")},null,8,["modelValue","class"]),F.value?(l(),n("p",Se,o(F.value),1)):h("",!0)]),e("div",Fe,[e("div",$e,[u(s(k),{name:"info",class:"h-5 w-5 text-yellow-600 flex-shrink-0 mt-0.5"}),d[8]||(d[8]=e("div",{class:"text-sm text-yellow-800"},[e("p",{class:"font-semibold mb-1"},"Proceso de aprobaci\xF3n:"),e("ul",{class:"list-disc list-inside space-y-1 text-xs"},[e("li",null,"Su solicitud ser\xE1 revisada por el departamento de RRHH"),e("li",null,"Recibir\xE1 una notificaci\xF3n cuando sea procesada"),e("li",null,"Si es aprobada, su IBAN se actualizar\xE1 autom\xE1ticamente")])],-1))])]),f.value?(l(),n("div",Ne,[u(s(le),{message:f.value},null,8,["message"])])):h("",!0)])])]),_:1},8,["modelValue","options"]))}},Pe={class:"p-5 text-base text-gray-800 max-h-[70vh] overflow-y-auto"},Ve={class:"space-y-5"},je={class:"bg-red-50 border border-red-200 rounded-lg p-4"},De={class:"flex items-start gap-2"},Ae={class:"bg-gray-50 p-4 rounded-lg border border-gray-200"},Ce={class:"flex items-center gap-2"},Ue={class:"font-mono text-sm text-gray-900"},Me={class:"flex items-center gap-2"},qe={key:0,class:"mt-1 text-sm text-red-600"},ze={key:1,class:"mt-1 text-xs text-gray-500"},Te=["min"],Oe={key:0,class:"mt-1 text-sm text-red-600"},Le={key:1,class:"mt-1 text-xs text-gray-500"},Ge={key:0,class:"mt-1 text-sm text-red-600"},He={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Je={class:"flex items-start gap-3 cursor-pointer"},Ke={class:"text-sm font-medium text-blue-900"},Xe={class:"text-xs text-blue-700 mt-1"},Ze={key:0,class:"mt-2 text-sm text-red-600"},Qe={class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},We={class:"flex items-start gap-2"},Ye={key:0},et={__name:"IrpfRetentionDialog",props:{modelValue:{type:Boolean,default:!1},currentIrpf:{type:Number,default:0},employeeId:{type:String,required:!0}},emits:["update:modelValue","success"],setup(P,{emit:A}){const r=P,S=A,R=D({get:()=>r.modelValue,set:x=>S("update:modelValue",x)}),g=D(()=>new Date().toISOString().split("T")[0]),i=E({requested_irpf:null,irpf_type:"Incremento voluntario",effective_date:"",reason:"",voluntary_declaration:!1}),b=E(!1),p=E(null),f=E(""),w=E(""),_=E(""),F=E(""),q=D(()=>{var a;const x=i.value.requested_irpf!==null&&i.value.requested_irpf>=0&&i.value.requested_irpf<=100&&!f.value,c=!!i.value.effective_date,v=!!((a=i.value.reason)==null?void 0:a.trim()),V=i.value.voluntary_declaration===!0;return x&&c&&v&&V&&!b.value}),G=D(()=>{switch(i.value.irpf_type){case"Incremento voluntario":return"Declaro que solicito voluntariamente un tipo de retenci\xF3n IRPF SUPERIOR al calculado reglamentariamente *";case"Reducci\xF3n a m\xEDnimo legal":return"Declaro que solicito voluntariamente la aplicaci\xF3n del tipo de retenci\xF3n M\xCDNIMO legal *";default:return"Declaro que solicito voluntariamente la modificaci\xF3n de mi tipo de retenci\xF3n IRPF *"}}),z=D(()=>{switch(i.value.irpf_type){case"Incremento voluntario":return"En virtud del art. 88.5 del Reglamento del IRPF (Real Decreto 439/2007), solicito que se me aplique el porcentaje de retenci\xF3n indicado, entendi\xE9ndose \xE9ste superior al resultante de lo previsto en dicho Reglamento. Este nuevo tipo de retenci\xF3n se aplicar\xE1, como m\xEDnimo, hasta el final del a\xF1o y, en tanto no renuncie por escrito al mismo o no solicite un tipo de retenci\xF3n superior, durante los ejercicios sucesivos.";case"Reducci\xF3n a m\xEDnimo legal":return"Solicito que se me aplique el tipo de retenci\xF3n m\xEDnimo legal establecido en el Reglamento del IRPF (Real Decreto 439/2007) seg\xFAn mis circunstancias personales y familiares. Este tipo de retenci\xF3n se calcular\xE1 conforme a los datos comunicados en el modelo 145.";default:return"Solicito voluntariamente la modificaci\xF3n de mi porcentaje de retenci\xF3n IRPF al indicado en esta solicitud. Entiendo que este cambio se aplicar\xE1 seg\xFAn las disposiciones del Reglamento del IRPF (Real Decreto 439/2007)."}}),C=U({url:"portal_rrhh.api.irpf.create_irpf_retention_request",method:"POST",onSuccess(){S("success"),R.value=!1,B(),window.frappe&&window.frappe.show_alert&&window.frappe.show_alert({message:"Solicitud enviada correctamente. Puedes ver su estado en tu perfil.",indicator:"green"})},onError(x){x.messages?p.value=x.messages.join(`
`):p.value=x.message||"Error al crear la solicitud"}});function I(){if(i.value.requested_irpf===null||i.value.requested_irpf===""){f.value="";return}const x=parseFloat(i.value.requested_irpf);if(isNaN(x)){f.value="Debe introducir un n\xFAmero v\xE1lido";return}if(x<0){f.value="El porcentaje no puede ser negativo";return}if(x>100){f.value="El porcentaje no puede superar el 100%";return}f.value=""}function t(){return Z(this,null,function*(){var c;if(b.value)return;if(b.value=!0,p.value=null,f.value="",w.value="",_.value="",F.value="",i.value.requested_irpf===null||i.value.requested_irpf===""){f.value="El porcentaje de retenci\xF3n IRPF es obligatorio",b.value=!1;return}const x=parseFloat(i.value.requested_irpf);if(isNaN(x)||x<0||x>100){f.value="El porcentaje debe estar entre 0 y 100",b.value=!1;return}if(!i.value.effective_date){w.value="La fecha de efecto es obligatoria",b.value=!1;return}if(!((c=i.value.reason)==null?void 0:c.trim())){_.value="El motivo de la solicitud es obligatorio",b.value=!1;return}if(!i.value.voluntary_declaration){F.value="Debe confirmar la declaraci\xF3n voluntaria",b.value=!1;return}try{const v={data:{employee:r.employeeId,requested_irpf:x,irpf_type:i.value.irpf_type,effective_date:i.value.effective_date,reason:i.value.reason,voluntary_declaration:i.value.voluntary_declaration?1:0}};console.log("Enviando solicitud de retenci\xF3n IRPF:",v);const V=yield C.submit(v);console.log("Respuesta del servidor:",V)}catch(v){console.error("Error al crear solicitud:",v),v.messages&&Array.isArray(v.messages)?p.value=v.messages.join(`
`):v.messages?p.value=v.messages:v.exc?p.value=v.exc:p.value=v.message||"Error al crear la solicitud"}finally{b.value=!1}})}function B(){i.value={requested_irpf:null,irpf_type:"Incremento voluntario",effective_date:"",reason:"",voluntary_declaration:!1},p.value=null,f.value="",w.value="",_.value="",F.value=""}return te(R,x=>{x||B()}),(x,c)=>(l(),M(s(oe),{modelValue:R.value,"onUpdate:modelValue":c[5]||(c[5]=v=>R.value=v),options:{title:"Solicitar Modificaci\xF3n de Retenci\xF3n IRPF",size:"2xl",actions:[{label:"Enviar Solicitud",variant:"solid",loading:b.value,disabled:!q.value,onClick:t}]}},{"body-content":y(()=>[e("div",Pe,[e("div",Ve,[e("div",je,[e("div",De,[u(s(k),{name:"alert-triangle",class:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),c[6]||(c[6]=e("div",{class:"text-sm text-red-800"},[e("p",{class:"font-semibold mb-1"},"Campos obligatorios:"),e("ul",{class:"list-disc list-inside space-y-1 text-xs"},[e("li",null,"Debe indicar el porcentaje de retenci\xF3n IRPF deseado"),e("li",null,"Debe seleccionar la fecha de efecto"),e("li",null,"Debe indicar el motivo de la solicitud"),e("li",null,"Debe confirmar la declaraci\xF3n voluntaria")]),e("p",{class:"mt-2 text-xs font-medium"},"No podr\xE1 enviar la solicitud sin completar todos los campos obligatorios.")],-1))])]),e("div",Ae,[c[7]||(c[7]=e("label",{class:"block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2"}," Retenci\xF3n IRPF Actual ",-1)),e("div",Ce,[u(s(k),{name:"percent",class:"h-4 w-4 text-gray-500"}),e("span",Ue,o(P.currentIrpf)+"%",1)])]),e("div",null,[c[9]||(c[9]=e("label",{class:"block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2"}," Nueva Retenci\xF3n IRPF (%) * ",-1)),e("div",Me,[Q(e("input",{type:"number","onUpdate:modelValue":c[0]||(c[0]=v=>i.value.requested_irpf=v),min:"0",max:"100",step:"0.5",placeholder:"Ej: 15",class:H(["block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm",f.value?"border-red-500":""]),onInput:I},null,34),[[ne,i.value.requested_irpf,void 0,{number:!0}]]),c[8]||(c[8]=e("span",{class:"text-gray-500"},"%",-1))]),f.value?(l(),n("p",qe,o(f.value),1)):(l(),n("p",ze," Introduzca el porcentaje de retenci\xF3n IRPF deseado (0-100%) "))]),e("div",null,[c[11]||(c[11]=e("label",{class:"block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2"}," Tipo de Solicitud * ",-1)),Q(e("select",{"onUpdate:modelValue":c[1]||(c[1]=v=>i.value.irpf_type=v),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm"},[...c[10]||(c[10]=[e("option",{value:"Incremento voluntario"},"Incremento voluntario",-1),e("option",{value:"Reducci\xF3n a m\xEDnimo legal"},"Reducci\xF3n a m\xEDnimo legal",-1),e("option",{value:"Otro"},"Otro",-1)])],512),[[ie,i.value.irpf_type]])]),e("div",null,[c[12]||(c[12]=e("label",{class:"block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2"}," Fecha de Efecto * ",-1)),Q(e("input",{type:"date","onUpdate:modelValue":c[2]||(c[2]=v=>i.value.effective_date=v),min:g.value,class:H(["block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm",w.value?"border-red-500":""])},null,10,Te),[[ne,i.value.effective_date]]),w.value?(l(),n("p",Oe,o(w.value),1)):(l(),n("p",Le," Fecha a partir de la cual se aplicar\xE1 la nueva retenci\xF3n "))]),e("div",null,[u(s(se),{label:"Motivo de la solicitud *",type:"textarea",modelValue:i.value.reason,"onUpdate:modelValue":c[3]||(c[3]=v=>i.value.reason=v),rows:"3",placeholder:"Explique el motivo por el que solicita la modificaci\xF3n de su retenci\xF3n IRPF...",class:H(_.value?"border-red-500":"")},null,8,["modelValue","class"]),_.value?(l(),n("p",Ge,o(_.value),1)):h("",!0)]),e("div",He,[e("label",Je,[Q(e("input",{type:"checkbox","onUpdate:modelValue":c[4]||(c[4]=v=>i.value.voluntary_declaration=v),class:"mt-1 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[re,i.value.voluntary_declaration]]),e("div",null,[e("span",Ke,o(G.value),1),e("p",Xe,o(z.value),1)])]),F.value?(l(),n("p",Ze,o(F.value),1)):h("",!0)]),e("div",Qe,[e("div",We,[u(s(k),{name:"info",class:"h-5 w-5 text-yellow-600 flex-shrink-0 mt-0.5"}),c[13]||(c[13]=e("div",{class:"text-sm text-yellow-800"},[e("p",{class:"font-semibold mb-1"},"Proceso de aprobaci\xF3n:"),e("ul",{class:"list-disc list-inside space-y-1 text-xs"},[e("li",null,"Su solicitud ser\xE1 revisada por su responsable directo y el departamento de RRHH"),e("li",null,"Recibir\xE1 una notificaci\xF3n cuando sea procesada"),e("li",null,"Si es aprobada, su retenci\xF3n IRPF se actualizar\xE1 autom\xE1ticamente"),e("li",null,"El cambio se aplicar\xE1 a partir de la fecha de efecto indicada")])],-1))])]),p.value?(l(),n("div",Ye,[u(s(le),{message:p.value},null,8,["message"])])):h("",!0)])])]),_:1},8,["modelValue","options"]))}},tt={class:"px-5 py-6 sm:px-8 h-full overflow-y-auto"},st={class:"mb-6 flex flex-col justify-between sm:flex-row sm:items-center"},at={key:0,class:"mt-4 sm:mt-0"},lt={class:"grid grid-cols-1 gap-6 lg:grid-cols-2"},ot={class:"flex items-center gap-2"},nt={class:"space-y-4 p-4"},it={class:"flex items-center gap-4"},rt={class:"flex h-20 w-20 items-center justify-center rounded-full bg-gray-100 text-2xl font-semibold text-gray-600"},dt={class:"text-lg font-semibold text-gray-900"},ut={class:"text-sm text-gray-500"},ct={class:"border-t pt-4"},mt={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},pt={class:"mt-1 text-sm text-gray-900"},ft={class:"mt-1 flex flex-wrap gap-1"},vt={key:0,class:"text-xs text-gray-500"},gt={class:"flex items-center gap-2"},xt={class:"p-4"},bt={key:0,class:"flex justify-center py-8"},yt={key:1,class:"rounded-md bg-red-50 p-4 text-red-700"},_t={key:0,class:"text-xs mt-1"},ht={key:2,class:"py-8 text-center text-gray-500"},wt={key:3,class:"space-y-4"},kt={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},It={class:"mt-1 text-sm font-medium text-gray-900"},Rt={class:"mt-1 text-sm text-gray-900"},Et={class:"mt-1 text-sm text-gray-900"},St={class:"mt-1 text-sm text-gray-900"},Ft={class:"mt-1 text-sm text-gray-900"},$t={class:"mt-1 text-sm text-gray-900"},Nt={class:"mt-1 text-sm text-gray-900"},Bt={class:"mt-1 text-sm text-gray-900"},Pt={class:"mt-1 text-sm text-gray-900 font-mono"},Vt={class:"mt-1 text-sm text-gray-900"},jt={class:"border-t pt-4 mt-4 space-y-3"},Dt={key:0,class:"bg-amber-50 border border-amber-200 rounded-lg p-3 mt-3"},At={class:"flex items-start gap-2"},Ct={key:1,class:"border-t pt-4 mt-4"},Ut={class:"block text-xs font-medium uppercase text-gray-500 mb-2"},Mt={class:"flex flex-wrap gap-2"},qt={class:"flex items-center gap-2"},zt={class:"p-4"},Tt={key:0,class:"flex justify-center py-8"},Ot={key:1,class:"rounded-md bg-red-50 p-4 text-red-700"},Lt={key:2,class:"py-8 text-center text-gray-500"},Gt={key:3,class:"space-y-3"},Ht={class:"flex items-start justify-between mb-2"},Jt={class:"flex-1"},Kt={class:"flex items-center gap-2 mb-1"},Xt={class:"text-sm font-semibold text-gray-900"},Zt={class:"text-xs text-gray-500"},Qt={class:"grid grid-cols-1 gap-2 mt-3 text-sm"},Wt={key:0,class:"flex items-center gap-2"},Yt={class:"font-mono text-gray-900"},es={key:1,class:"flex items-center gap-2"},ts={class:"font-mono text-gray-900"},ss={key:2,class:"flex items-center gap-2"},as={class:"text-gray-900"},ls={key:3,class:"flex items-start gap-2 mt-2 pt-2 border-t"},os={class:"text-gray-900"},ns={class:"flex items-center gap-2"},is={class:"p-4"},rs={key:0,class:"flex justify-center py-8"},ds={key:1,class:"rounded-md bg-red-50 p-4 text-red-700"},us={key:2,class:"py-8 text-center text-gray-500"},cs={key:3,class:"space-y-3"},ms={class:"flex items-start justify-between mb-2"},ps={class:"flex-1"},fs={class:"flex items-center gap-2 mb-1"},vs={class:"text-sm font-semibold text-gray-900"},gs={class:"text-xs text-gray-500"},xs={class:"grid grid-cols-1 gap-2 mt-3 text-sm"},bs={class:"flex items-center gap-2"},ys={class:"text-gray-900"},_s={class:"flex items-center gap-2"},hs={class:"font-semibold text-gray-900"},ws={class:"flex items-center gap-2"},ks={class:"text-gray-900"},Is={class:"flex items-center gap-2"},Rs={class:"text-gray-900"},Es={key:0,class:"flex items-start gap-2 mt-2 pt-2 border-t"},Ss={class:"text-gray-900"},Fs={class:"flex items-center gap-2"},$s={class:"p-4"},Ns={key:0,class:"flex justify-center py-8"},Bs={key:1,class:"rounded-md bg-red-50 p-4 text-red-700"},Ps={key:2,class:"py-8 text-center text-gray-500"},Vs={key:3,class:"space-y-3"},js={class:"flex items-start justify-between mb-2"},Ds={class:"flex-1"},As={class:"flex items-center gap-2 mb-1"},Cs={class:"text-sm font-semibold text-gray-900"},Us={class:"text-xs text-gray-500"},Ms={class:"grid grid-cols-2 md:grid-cols-4 gap-3 mt-3 text-sm"},qs={class:"text-gray-900"},zs={class:"text-gray-900"},Ts={class:"text-gray-900"},Os={class:"text-gray-900"},Ls={key:0,class:"mt-3 pt-3 border-t text-xs text-gray-500"},Xs={__name:"Profile",setup(P){const A=D(()=>{const I=L().getUser("sessionUser").full_name;return I?I.split(" ").map(t=>t[0]).join("").substring(0,2).toUpperCase():"?"}),r=U({url:"portal_rrhh.api.employee.get_current_employee",auto:!0}),S=U({url:"portal_rrhh.api.iban.get_my_iban_requests",auto:!1}),R=U({url:"portal_rrhh.api.irpf.get_my_irpf_requests",auto:!1}),g=U({url:"portal_rrhh.api.modelo145.get_my_modelo_145_list",auto:!1}),i=U({url:"portal_rrhh.api.modelo145.has_modelo_145",auto:!1}),b=E(!1),p=E(!1),f=E(!1);te(()=>r.data,I=>{I&&I.name&&(S.reload(),R.reload(),g.reload(),i.reload())},{immediate:!0});function w(I){var B;if(!I)return"";const t=I.replace(/\s/g,"");return((B=t.match(/.{1,4}/g))==null?void 0:B.join(" "))||t}function _(I){return I?new Date(I).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}):"-"}function F(I){return{Open:"orange",Approved:"green",Rejected:"red"}[I]||"gray"}function q(I){return{Open:"Pendiente",Approved:"Aprobada",Rejected:"Rechazada"}[I]||I}function G(){r.reload(),S.reload()}function z(){r.reload(),R.reload()}function C(){r.reload(),g.reload(),i.reload()}return(I,t)=>{var B,x,c,v,V;return l(),n("div",tt,[e("div",st,[t[6]||(t[6]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900"},"Mi Perfil"),e("p",{class:"text-base text-gray-500"}," Detalles de tu cuenta y perfil de empleado ")],-1)),s(r).data&&s(r).data.status?(l(),n("div",at,[u(s(O),{theme:s(r).data.status==="Active"?"green":s(r).data.status==="Left"?"red":"orange",size:"lg"},{default:y(()=>[j(o(s(r).data.status),1)]),_:1},8,["theme"])])):h("",!0)]),e("div",lt,[u(s(J),{class:"h-full"},{header:y(()=>[e("div",ot,[u(s(k),{name:"user",class:"h-5 w-5 text-gray-500"}),t[7]||(t[7]=e("span",{class:"text-lg font-medium"},"Cuenta de Usuario",-1))])]),default:y(()=>[e("div",nt,[e("div",it,[e("div",rt,o(A.value),1),e("div",null,[e("h3",dt,o(s(de)().user),1),e("p",ut,o(s(L)().getUser("sessionUser").full_name||"Sin nombre"),1)])]),e("div",ct,[e("div",mt,[e("div",null,[t[8]||(t[8]=e("label",{class:"block text-xs font-medium uppercase text-gray-500"},"Email",-1)),e("div",pt,o(s(L)().getUser("sessionUser").email||"No disponible"),1)]),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-xs font-medium uppercase text-gray-500"},"Roles",-1)),e("div",ft,[(l(!0),n(K,null,X((s(L)().getUser("sessionUser").roles||[]).slice(0,3),a=>(l(),M(s(O),{key:a,theme:"gray"},{default:y(()=>[j(o(a),1)]),_:2},1024))),128)),(s(L)().getUser("sessionUser").roles||[]).length>3?(l(),n("span",vt,"+"+o(s(L)().getUser("sessionUser").roles.length-3),1)):h("",!0)])])])])])]),_:1}),u(s(J),{class:"h-full"},{header:y(()=>[e("div",gt,[u(s(k),{name:"briefcase",class:"h-5 w-5 text-gray-500"}),t[10]||(t[10]=e("span",{class:"text-lg font-medium"},"Informaci\xF3n de Empleado",-1))])]),default:y(()=>[e("div",xt,[s(r).loading?(l(),n("div",bt,[u(s(W))])):s(r).error?(l(),n("div",yt,[t[11]||(t[11]=e("p",null,"No se pudo cargar la informaci\xF3n del empleado.",-1)),s(r).error.message?(l(),n("p",_t,o(s(r).error.message),1)):h("",!0)])):s(r).data?(l(),n("div",wt,[e("div",kt,[e("div",null,[t[13]||(t[13]=e("label",{class:"block text-xs font-medium uppercase text-gray-500"},"Nombre Completo",-1)),e("div",It,o(s(r).data.employee_name),1)]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-xs font-medium uppercase text-gray-500"},"N\xFAmero de Empleado",-1)),e("div",Rt,o(s(r).data.employee_number||"-"),1)]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-xs font-medium uppercase text-gray-500"},"Departamento",-1)),e("div",Et,o(s(r).data.department||"-"),1)]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-xs font-medium uppercase text-gray-500"},"Puesto",-1)),e("div",St,o(s(r).data.designation||"-"),1)]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-xs font-medium uppercase text-gray-500"},"Reporta a",-1)),e("div",Ft,o(s(r).data.reports_to||"-"),1)]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-xs font-medium uppercase text-gray-500"},"Fecha de Ingreso",-1)),e("div",$t,o(s(r).data.date_of_joining||"-"),1)]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-xs font-medium uppercase text-gray-500"},"Empresa",-1)),e("div",Nt,o(s(r).data.company||"-"),1)]),e("div",null,[t[20]||(t[20]=e("label",{class:"block text-xs font-medium uppercase text-gray-500"},"Email Empresa",-1)),e("div",Bt,o(s(r).data.company_email||"-"),1)]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-xs font-medium uppercase text-gray-500"},"IBAN",-1)),e("div",Pt,o(w(s(r).data.iban)||"-"),1)]),e("div",null,[t[22]||(t[22]=e("label",{class:"block text-xs font-medium uppercase text-gray-500"},"Retenci\xF3n IRPF",-1)),e("div",Vt,o(s(r).data.custom_irpf?s(r).data.custom_irpf+"%":"-"),1)])]),e("div",jt,[u(s(ae),{onClick:t[0]||(t[0]=a=>b.value=!0),class:"w-full !bg-blue-600 hover:!bg-blue-700 !text-white"},{prefix:y(()=>[u(s(k),{name:"credit-card",class:"h-4 w-4"})]),default:y(()=>[t[23]||(t[23]=j(" Solicitar Cambio de IBAN ",-1))]),_:1}),u(s(ae),{onClick:t[1]||(t[1]=a=>p.value=!0),class:"w-full !bg-emerald-600 hover:!bg-emerald-700 !text-white"},{prefix:y(()=>[u(s(k),{name:"percent",class:"h-4 w-4"})]),default:y(()=>[t[24]||(t[24]=j(" Solicitar Modificaci\xF3n de Retenci\xF3n IRPF ",-1))]),_:1}),u(s(ae),{onClick:t[2]||(t[2]=a=>f.value=!0),class:"w-full !bg-amber-600 hover:!bg-amber-700 !text-white"},{prefix:y(()=>[u(s(k),{name:"file-text",class:"h-4 w-4"})]),default:y(()=>[t[25]||(t[25]=j(" Presentar Modelo 145 ",-1))]),_:1})]),s(i).data&&!s(i).data.has_modelo?(l(),n("div",Dt,[e("div",At,[u(s(k),{name:"alert-circle",class:"h-5 w-5 text-amber-600 flex-shrink-0 mt-0.5"}),t[26]||(t[26]=e("div",{class:"text-sm text-amber-800"},[e("p",{class:"font-semibold"},"Modelo 145 pendiente"),e("p",{class:"text-xs mt-1"}," A\xFAn no has presentado tu Modelo 145 (Comunicaci\xF3n de datos al pagador). Este documento es necesario para calcular correctamente tus retenciones de IRPF. ")],-1))])])):h("",!0),s(r).data.companies&&s(r).data.companies.length>0?(l(),n("div",Ct,[e("label",Ut,o(s(r).data.status_text),1),e("div",Mt,[(l(!0),n(K,null,X(s(r).data.companies,a=>(l(),M(s(O),{key:a,theme:"blue"},{default:y(()=>[j(o(a),1)]),_:2},1024))),128))])])):h("",!0)])):(l(),n("div",ht,[u(s(k),{name:"alert-circle",class:"mx-auto mb-2 h-8 w-8 text-gray-400"}),t[12]||(t[12]=e("p",null,"Este usuario no tiene un perfil de empleado asociado.",-1))]))])]),_:1}),s(r).data?(l(),M(s(J),{key:0,class:"h-full"},{header:y(()=>[e("div",qt,[u(s(k),{name:"credit-card",class:"h-5 w-5 text-gray-500"}),t[27]||(t[27]=e("span",{class:"text-lg font-medium"},"Solicitudes de Cambio de IBAN",-1))])]),default:y(()=>[e("div",zt,[s(S).loading?(l(),n("div",Tt,[u(s(W))])):s(S).error?(l(),n("div",Ot,[...t[28]||(t[28]=[e("p",null,"No se pudieron cargar las solicitudes.",-1)])])):!s(S).data||s(S).data.length===0?(l(),n("div",Lt,[u(s(k),{name:"inbox",class:"mx-auto mb-2 h-8 w-8 text-gray-400"}),t[29]||(t[29]=e("p",null,"No tienes solicitudes de cambio de IBAN.",-1))])):(l(),n("div",Gt,[(l(!0),n(K,null,X(s(S).data,a=>(l(),n("div",{key:a.name,class:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors"},[e("div",Ht,[e("div",Jt,[e("div",Kt,[e("span",Xt,o(a.name),1),u(s(O),{theme:F(a.status),size:"sm"},{default:y(()=>[j(o(q(a.status)),1)]),_:2},1032,["theme"])]),e("p",Zt," Fecha de solicitud: "+o(_(a.posting_date||a.creation)),1)])]),e("div",Qt,[a.current_iban?(l(),n("div",Wt,[t[30]||(t[30]=e("span",{class:"text-gray-500 min-w-[100px]"},"IBAN Actual:",-1)),e("span",Yt,o(w(a.current_iban)),1)])):h("",!0),a.new_iban?(l(),n("div",es,[t[31]||(t[31]=e("span",{class:"text-gray-500 min-w-[100px]"},"Nuevo IBAN:",-1)),e("span",ts,o(w(a.new_iban)),1)])):h("",!0),a.bank_entity?(l(),n("div",ss,[t[32]||(t[32]=e("span",{class:"text-gray-500 min-w-[100px]"},"Entidad:",-1)),e("span",as,o(a.bank_entity),1)])):h("",!0),a.approval_notes?(l(),n("div",ls,[t[33]||(t[33]=e("span",{class:"text-gray-500 min-w-[100px]"},"Notas:",-1)),e("span",os,o(a.approval_notes),1)])):h("",!0)])]))),128))]))])]),_:1})):h("",!0),s(r).data?(l(),M(s(J),{key:1,class:"h-full"},{header:y(()=>[e("div",ns,[u(s(k),{name:"percent",class:"h-5 w-5 text-gray-500"}),t[34]||(t[34]=e("span",{class:"text-lg font-medium"},"Solicitudes de Retenci\xF3n IRPF",-1))])]),default:y(()=>[e("div",is,[s(R).loading?(l(),n("div",rs,[u(s(W))])):s(R).error?(l(),n("div",ds,[...t[35]||(t[35]=[e("p",null,"No se pudieron cargar las solicitudes.",-1)])])):!s(R).data||s(R).data.length===0?(l(),n("div",us,[u(s(k),{name:"inbox",class:"mx-auto mb-2 h-8 w-8 text-gray-400"}),t[36]||(t[36]=e("p",null,"No tienes solicitudes de retenci\xF3n IRPF.",-1))])):(l(),n("div",cs,[(l(!0),n(K,null,X(s(R).data,a=>(l(),n("div",{key:a.name,class:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors"},[e("div",ms,[e("div",ps,[e("div",fs,[e("span",vs,o(a.name),1),u(s(O),{theme:F(a.status),size:"sm"},{default:y(()=>[j(o(q(a.status)),1)]),_:2},1032,["theme"])]),e("p",gs," Fecha de solicitud: "+o(_(a.posting_date||a.creation)),1)])]),e("div",xs,[e("div",bs,[t[37]||(t[37]=e("span",{class:"text-gray-500 min-w-[120px]"},"IRPF Actual:",-1)),e("span",ys,o(a.current_irpf||0)+"%",1)]),e("div",_s,[t[38]||(t[38]=e("span",{class:"text-gray-500 min-w-[120px]"},"IRPF Solicitado:",-1)),e("span",hs,o(a.requested_irpf)+"%",1)]),e("div",ws,[t[39]||(t[39]=e("span",{class:"text-gray-500 min-w-[120px]"},"Tipo:",-1)),e("span",ks,o(a.irpf_type),1)]),e("div",Is,[t[40]||(t[40]=e("span",{class:"text-gray-500 min-w-[120px]"},"Fecha de Efecto:",-1)),e("span",Rs,o(_(a.effective_date)),1)]),a.approval_notes?(l(),n("div",Es,[t[41]||(t[41]=e("span",{class:"text-gray-500 min-w-[120px]"},"Notas:",-1)),e("span",Ss,o(a.approval_notes),1)])):h("",!0)])]))),128))]))])]),_:1})):h("",!0),s(r).data?(l(),M(s(J),{key:2,class:"h-full lg:col-span-2"},{header:y(()=>[e("div",Fs,[u(s(k),{name:"file-text",class:"h-5 w-5 text-amber-500"}),t[42]||(t[42]=e("span",{class:"text-lg font-medium"},"Modelo 145 - Comunicaci\xF3n de Datos al Pagador",-1))])]),default:y(()=>[e("div",$s,[s(g).loading?(l(),n("div",Ns,[u(s(W))])):s(g).error?(l(),n("div",Bs,[...t[43]||(t[43]=[e("p",null,"No se pudieron cargar los modelos.",-1)])])):!s(g).data||s(g).data.length===0?(l(),n("div",Ps,[u(s(k),{name:"file-text",class:"mx-auto mb-2 h-8 w-8 text-gray-400"}),t[44]||(t[44]=e("p",null,"No has presentado ning\xFAn Modelo 145.",-1)),t[45]||(t[45]=e("p",{class:"text-xs mt-2"},"Presenta tu Modelo 145 para comunicar tu situaci\xF3n personal y familiar.",-1))])):(l(),n("div",Vs,[(l(!0),n(K,null,X(s(g).data,a=>{var d;return l(),n("div",{key:a.name,class:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors"},[e("div",js,[e("div",Ds,[e("div",As,[e("span",Cs,o(a.name),1),u(s(O),{theme:a.status==="Received"?"green":"orange",size:"sm"},{default:y(()=>[j(o(a.status==="Received"?"Procesado":"Pendiente"),1)]),_:2},1032,["theme"])]),e("p",Us," Fecha de presentaci\xF3n: "+o(_(a.posting_date||a.creation)),1)])]),e("div",Ms,[e("div",null,[t[46]||(t[46]=e("span",{class:"text-gray-500 text-xs block"},"Situaci\xF3n Familiar",-1)),e("span",qs,o(((d=a.family_situation)==null?void 0:d.split(".")[0])||"-"),1)]),e("div",null,[t[47]||(t[47]=e("span",{class:"text-gray-500 text-xs block"},"Descendientes",-1)),e("span",zs,o(a.descendants_count||0),1)]),e("div",null,[t[48]||(t[48]=e("span",{class:"text-gray-500 text-xs block"},"Ascendientes",-1)),e("span",Ts,o(a.ascendants_count||0),1)]),e("div",null,[t[49]||(t[49]=e("span",{class:"text-gray-500 text-xs block"},"Fecha de Efecto",-1)),e("span",Os,o(_(a.effective_date)),1)])]),a.received_date?(l(),n("div",Ls," Procesado el "+o(_(a.received_date)),1)):h("",!0)])}),128))]))])]),_:1})):h("",!0)]),u(Be,{modelValue:b.value,"onUpdate:modelValue":t[3]||(t[3]=a=>b.value=a),"current-iban":((B=s(r).data)==null?void 0:B.iban)||"","employee-id":((x=s(r).data)==null?void 0:x.name)||"",onSuccess:G},null,8,["modelValue","current-iban","employee-id"]),u(et,{modelValue:p.value,"onUpdate:modelValue":t[4]||(t[4]=a=>p.value=a),"current-irpf":parseFloat(((c=s(r).data)==null?void 0:c.custom_irpf)||"0"),"employee-id":((v=s(r).data)==null?void 0:v.name)||"",onSuccess:z},null,8,["modelValue","current-irpf","employee-id"]),u(ue,{modelValue:f.value,"onUpdate:modelValue":t[5]||(t[5]=a=>f.value=a),"employee-id":((V=s(r).data)==null?void 0:V.name)||"",onSuccess:C},null,8,["modelValue","employee-id"])])}}};export{Xs as default};
